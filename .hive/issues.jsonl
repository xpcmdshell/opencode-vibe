{"id":"cell--xts0a-mjnpy82bz63","title":"Scaffold opencode-next turborepo with Next.js 16","description":"Greenfield turborepo: bun workspaces, Next.js 16 canary + turbopack, typescript-go, oxlint, biome, ai-elements. Simplified structure with future-extraction-ready src folders.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T03:06:23.699Z","updated_at":"2025-12-27T03:33:41.342Z","closed_at":"2025-12-27T03:33:41.342Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--xts0a-mjnpy82ip5k","title":"Scaffold turborepo root with bun + tooling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:06:23.706Z","updated_at":"2025-12-27T03:11:58.610Z","closed_at":"2025-12-27T03:11:58.610Z","parent_id":"cell--xts0a-mjnpy82bz63","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--xts0a-mjnpy82k4sa","title":"Create Next.js 16 app in apps/web","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:06:23.708Z","updated_at":"2025-12-27T03:15:53.511Z","closed_at":"2025-12-27T03:15:53.511Z","parent_id":"cell--xts0a-mjnpy82bz63","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--xts0a-mjnpy82mmra","title":"Initialize ai-elements in apps/web","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:06:23.710Z","updated_at":"2025-12-27T03:33:38.254Z","closed_at":"2025-12-27T03:33:38.254Z","parent_id":"cell--xts0a-mjnpy82bz63","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--xts0a-mjnpy82osxv","title":"Update ADR to reflect simplified structure","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T03:06:23.712Z","updated_at":"2025-12-27T03:11:56.353Z","closed_at":"2025-12-27T03:11:56.353Z","parent_id":"cell--xts0a-mjnpy82bz63","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--xts0a-mjnpy82q88g","title":"Write AGENTS.md for the project","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T03:06:23.714Z","updated_at":"2025-12-27T03:11:57.211Z","closed_at":"2025-12-27T03:11:57.211Z","parent_id":"cell--xts0a-mjnpy82bz63","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnqskkevn2","title":"Replace eslint with oxlint + biome in apps/web","description":"create-next-app installed eslint by default. We want the new stack:\n- Remove eslint, eslint-config-next\n- Remove eslint.config.mjs\n- Add oxlint for linting\n- Use biome from root for formatting\n- Update package.json scripts to use oxlint/biome","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T03:29:59.582Z","updated_at":"2025-12-27T03:33:39.760Z","closed_at":"2025-12-27T03:33:39.760Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrabt06q2","title":"Wire up OpenCode SDK connection in apps/web","description":"## Context\n\nSetting up SDK connection to OpenCode server. Current state:\n\n### Files Created\n- `apps/web/src/core/client.ts` - SDK client factory wrapper\n- `apps/web/src/core/poc.ts` - POC script to test connection\n\n### SDK Installed\n- `@opencode-ai/sdk@1.0.203` in apps/web\n\n### SDK API (from ADR)\n```typescript\nconst client = createOpencodeClient({ baseUrl, directory })\n\n// Namespaces:\nclient.session.list()      // CRUD, messages, prompt\nclient.provider.list()     // AI providers\nclient.project.current()   // Current project\nclient.config.get()        // Config\nclient.global.event()      // SSE subscription\n// ... 15+ namespaces total\n```\n\n### Challenges\n1. OpenCode server runs on random port\n2. Server needs to run from a project directory (has Instance context)\n3. POC script tries to spawn server and capture port from output\n\n### Next Steps\n- Fix POC to properly spawn server and parse port\n- Or: accept port as env var for dev (simpler)\n- Wire up React hooks in src/react/\n- SSE subscription for real-time updates","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T03:43:48.036Z","updated_at":"2025-12-27T03:58:53.478Z","closed_at":"2025-12-27T03:58:53.478Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrh2fhuxd","title":"Wire up OpenCode SDK connection","description":"Fix provider display bug, create React hooks (useSession, useMessages, useProvider, useSSE), and set up SSE subscription for real-time updates","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T03:49:02.477Z","updated_at":"2025-12-27T03:58:52.063Z","closed_at":"2025-12-27T03:58:52.063Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrh2fqml6","title":"Fix provider display in POC","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T03:49:02.486Z","updated_at":"2025-12-27T03:53:52.933Z","closed_at":"2025-12-27T03:53:52.933Z","parent_id":"opencode-next--xts0a-mjnrh2fhuxd","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrh2fsop7","title":"Create useSSE hook for real-time updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:49:02.488Z","updated_at":"2025-12-27T03:53:54.439Z","closed_at":"2025-12-27T03:53:54.439Z","parent_id":"opencode-next--xts0a-mjnrh2fhuxd","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrh2fuict","title":"Create useProvider hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:49:02.490Z","updated_at":"2025-12-27T03:58:42.908Z","closed_at":"2025-12-27T03:58:42.908Z","parent_id":"opencode-next--xts0a-mjnrh2fhuxd","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrh2fxlxj","title":"Create useSession hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:49:02.493Z","updated_at":"2025-12-27T03:58:44.066Z","closed_at":"2025-12-27T03:58:44.066Z","parent_id":"opencode-next--xts0a-mjnrh2fhuxd","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrh2g0q4n","title":"Create useMessages hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T03:49:02.496Z","updated_at":"2025-12-27T03:58:45.419Z","closed_at":"2025-12-27T03:58:45.419Z","parent_id":"opencode-next--xts0a-mjnrh2fhuxd","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrw80g28x","title":"Minimal POC UI with entity pages","description":"Basic UI showing hooks work: root dashboard with providers/sessions, clickable through to /session/[id] and /provider/[id] pages. Raw data display, no fancy styling.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T04:00:49.552Z","updated_at":"2025-12-27T04:04:15.213Z","closed_at":"2025-12-27T04:04:15.213Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrw80mxqb","title":"Create root dashboard page","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T04:00:49.558Z","updated_at":"2025-12-27T04:04:11.433Z","closed_at":"2025-12-27T04:04:11.433Z","parent_id":"opencode-next--xts0a-mjnrw80g28x","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrw80pq4e","title":"Create session detail page","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T04:00:49.561Z","updated_at":"2025-12-27T04:04:12.278Z","closed_at":"2025-12-27T04:04:12.278Z","parent_id":"opencode-next--xts0a-mjnrw80g28x","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnrw80s972","title":"Create provider detail page","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T04:00:49.564Z","updated_at":"2025-12-27T04:04:13.640Z","closed_at":"2025-12-27T04:04:13.640Z","parent_id":"opencode-next--xts0a-mjnrw80g28x","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnt1qj2ib2","title":"Type-safe session rendering with ai-elements","description":"Create a type-safe transform layer from OpenCode SDK types to ai-elements types. Let TypeScript guide the mapping - import source types from @opencode-ai/sdk, import target types from ai-elements, write transforms that satisfy the compiler.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T04:33:06.446Z","updated_at":"2025-12-27T04:41:27.949Z","closed_at":"2025-12-27T04:41:27.949Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnt1qj9x34","title":"Create transform layer with SDK + ai-elements types","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T04:33:06.453Z","updated_at":"2025-12-27T04:36:32.621Z","closed_at":"2025-12-27T04:36:32.621Z","parent_id":"opencode-next--xts0a-mjnt1qj2ib2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnt1qjcvpr","title":"Integrate transform into useMessages hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T04:33:06.456Z","updated_at":"2025-12-27T04:41:24.542Z","closed_at":"2025-12-27T04:41:24.542Z","parent_id":"opencode-next--xts0a-mjnt1qj2ib2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnt1qjfy5i","title":"Update session page to use ai-elements components","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T04:33:06.459Z","updated_at":"2025-12-27T04:41:25.812Z","closed_at":"2025-12-27T04:41:25.812Z","parent_id":"opencode-next--xts0a-mjnt1qj2ib2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnupcu2ntg","title":"Full ai-elements component integration","description":"Replace basic session page rendering with proper ai-elements components. Use Message, Tool, Reasoning, CodeBlock, Conversation components for rich UI. Type-safe integration with existing transform layer.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T05:19:28.058Z","updated_at":"2025-12-27T05:25:08.095Z","closed_at":"2025-12-27T05:25:08.095Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnupcu84jd","title":"Research ai-elements component props and usage patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T05:19:28.064Z","updated_at":"2025-12-27T05:21:44.204Z","closed_at":"2025-12-27T05:21:44.204Z","parent_id":"opencode-next--xts0a-mjnupcu2ntg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnupcua1po","title":"Update session page to use ai-elements components","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T05:19:28.066Z","updated_at":"2025-12-27T05:25:06.657Z","closed_at":"2025-12-27T05:25:06.657Z","parent_id":"opencode-next--xts0a-mjnupcu2ntg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjnwjk9n5vx","title":"Debug: Message sending and SSE streaming not working","description":"## Context\n- Session page loads at http://localhost:8423/session/ses_4a242fb53ffekQiAoVBmQyEu2i?dir=%2FUsers%2Fjoel%2FCode%2Fjoelhooks%2Fopencode-next\n- OpenCode API server running on port 4056 (was hardcoded to 4096, fixed)\n- Next.js dev server on port 8423\n\n## Problem\n1. Sending a message via the input is \"swallowed\" - no visible response\n2. SSE streaming not working - new messages don't appear\n\n## Implementation State\n- `apps/web/src/app/session/[id]/session-messages.tsx` - Client component with:\n  - `handleSubmit` calls `client.session.prompt()` \n  - SSE subscriptions for `message.created`, `message.updated`, `message.part.updated`, `session.updated`\n  - Console logs added for debugging\n- `apps/web/src/react/use-sse.ts` - SSE hook using `globalClient.global.event()`\n- `apps/web/src/core/client.ts` - Client factory, now pointing to localhost:4056\n\n## Curl that should work\n```bash\ncurl -X POST \"http://localhost:4056/session/ses_xxx/message\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-opencode-directory: /Users/joel/Code/joelhooks/opencode-next\" \\\n  -d '{\"parts\": [{\"type\": \"text\", \"text\": \"hello\"}]}'\n```\n\n## Debug approach\nUse Chrome DevTools MCP to:\n1. Check console for errors/logs from handleSubmit\n2. Check Network tab for the POST request to /session/{id}/prompt\n3. Check if SSE connection is established\n4. Verify request/response payloads","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-27T06:10:56.987Z","updated_at":"2025-12-27T06:28:56.808Z","closed_at":"2025-12-27T06:28:56.808Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjoizozoxho","title":"Fix scroll behavior: page scroll instead of inner container","description":"Superseded by epic mjojc2dpcfn - Fix session page rendering issues","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T16:39:21.156Z","updated_at":"2025-12-27T16:49:32.906Z","closed_at":"2025-12-27T16:49:32.900Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjojc2dzs97","title":"Fix autoscroll - restore proper container hierarchy for use-stick-to-bottom","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-27T16:48:58.391Z","updated_at":"2025-12-27T16:54:10.699Z","closed_at":"2025-12-27T16:54:10.699Z","parent_id":"opencode-next--xts0a-mjojc2dpcfn","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjojei9n3sg","title":"Handle file content with line numbers - don't render as markdown","description":"Read tool output includes line numbers (00001| content) which breaks markdown parsing.\n\nThe `<file>` wrapped content should be rendered as a code block, not parsed as markdown.\n\nExample bad input:\n```\n<file>\n00001| # ADR 001: Title\n00002| \n00003| | Column | Column |\n</file>\n```\n\nThe line numbers break heading and table detection.\n\nFix options:\n1. In transform layer: detect `<file>` wrapper and convert to code block\n2. In MessageResponse: handle `<file>` tag specially (render as pre/code)\n3. Strip line numbers before markdown parsing\n\nFiles: \n- apps/web/src/lib/transform-messages.ts\n- apps/web/src/components/ai-elements/message.tsx","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T16:50:52.283Z","updated_at":"2025-12-27T16:52:59.742Z","closed_at":"2025-12-27T16:52:59.742Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjoj6stbspo","title":"Add context usage monitoring to session page","description":"Display context window usage (tokens, percentage, cost) in session header.\n\nRequirements:\n- Read token counts from assistant messages (input, output, reasoning, cache.read, cache.write)\n- Look up model context limit from provider (Claude Opus 4 = 200k context)\n- Calculate percentage: (totalTokens / model.limit.context) * 100\n- Show cumulative cost across all assistant messages\n- Display as progress indicator with tooltip showing details\n\nData sources:\n- AssistantMessage.tokens: { input, output, reasoning, cache: { read, write } }\n- AssistantMessage.cost: number (USD)\n- Provider.models[modelID].limit.context: number\n\nReference: packages/app/src/components/session-context-usage.tsx (SolidJS implementation)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T16:44:52.703Z","updated_at":"2025-12-27T17:41:41.764Z","closed_at":"2025-12-27T17:41:41.764Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjojc2dpcfn","title":"Fix session page rendering issues","description":"Multiple rendering issues on the session detail page need to be fixed:\n\n1. **Autoscroll broken** - Conversation component uses `use-stick-to-bottom` which requires proper container hierarchy\n2. **Code blocks/syntax highlighting bad** - Streamdown styles not loading properly\n3. **Tables rendering oddly** - GFM tables not styled correctly\n4. **Background inconsistency** - Fixed: changed `bg-zinc-50 dark:bg-black` to `bg-background`\n5. **Container hierarchy issues** - Need proper flex layout for scroll behavior\n\nRoot causes:\n- Tailwind v4 `@source` directive needed for streamdown classes\n- Container hierarchy breaking `use-stick-to-bottom` scroll behavior\n- Missing table/code block styles from streamdown","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T16:48:58.381Z","updated_at":"2025-12-27T17:52:36.649Z","closed_at":"2025-12-27T17:52:36.649Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjojc2e2n9q","title":"Add streamdown @source directive for Tailwind v4","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T16:48:58.394Z","updated_at":"2025-12-27T17:29:57.470Z","closed_at":"2025-12-27T17:29:57.470Z","parent_id":"opencode-next--xts0a-mjojc2dpcfn","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjojc2e8ar7","title":"Style markdown tables with Catppuccin theme","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:48:58.400Z","updated_at":"2025-12-27T17:52:33.787Z","closed_at":"2025-12-27T17:52:33.787Z","parent_id":"opencode-next--xts0a-mjojc2dpcfn","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjojc2eb3qn","title":"Style code blocks with Catppuccin theme","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:48:58.403Z","updated_at":"2025-12-27T17:52:34.874Z","closed_at":"2025-12-27T17:52:34.874Z","parent_id":"opencode-next--xts0a-mjojc2dpcfn","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjokdky4z0q","title":"Implement session creation for OpenCode React client","description":"Add ability to create new sessions from the web UI.\n\nRequirements:\n- POST /session with x-opencode-directory header\n- Hook for session creation (useCreateSession or mutation)\n- New Session button in header\n- Navigate to new session after creation\n- SSE already handles session.updated events\n\nAPI: POST /session with optional { title?: string } body\nResponse: Session object with id, projectID, directory, title, time","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T17:18:08.716Z","updated_at":"2025-12-27T17:29:56.642Z","closed_at":"2025-12-27T17:29:56.642Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjokf2gstrs","title":"Implement session creation for OpenCode React client","description":"Add ability to create new sessions from the web UI with useCreateSession hook and New Session button","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T17:19:18.076Z","updated_at":"2025-12-27T17:27:37.075Z","closed_at":"2025-12-27T17:27:37.075Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjokf2h03si","title":"Create useCreateSession hook","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T17:19:18.084Z","updated_at":"2025-12-27T17:23:41.858Z","closed_at":"2025-12-27T17:23:41.858Z","parent_id":"opencode-next--xts0a-mjokf2gstrs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjokf2h46e4","title":"Add New Session button to session page header","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T17:19:18.088Z","updated_at":"2025-12-27T17:27:36.109Z","closed_at":"2025-12-27T17:27:36.109Z","parent_id":"opencode-next--xts0a-mjokf2gstrs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjokkcl9tls","title":"Fix Streamdown TypeScript syntax leaking as HTML tags","description":"Multiple console errors from TypeScript syntax being parsed as HTML tags by Streamdown/markdown parser:\n\nIssues:\n1. `<r>`, `<any>`, `<string,>`, `<t>`, `<void>`, `<unknown>`, `<anonymous>` - TS generics as tags\n2. Invalid attributes: `promise<context`, `set<(event:`, `event)` - TS syntax as attributes\n3. `defaultvalue` vs `defaultValue` - React DOM property casing\n4. Missing key props in nested .map()\n\nRoot cause: Markdown parser is treating TypeScript generic syntax like `Map<string, any>` or `Promise<T>` as HTML tags.\n\nSolution options:\n1. Pre-process markdown to escape angle brackets in code contexts\n2. Custom rehype plugin to sanitize invalid tags\n3. Expand the Proxy fallback to handle more edge cases","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-27T17:23:24.477Z","updated_at":"2025-12-27T17:41:40.110Z","closed_at":"2025-12-27T17:41:40.110Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjokueyzve1","title":"Fix blocking route error on dashboard - wrap in Suspense","description":"Next.js 16 error: Uncached data accessed outside Suspense.\n\nError: Route \"/\": Uncached data or `connection()` was accessed outside of `<Suspense>`.\n\nFix: Wrap the async data fetching in Suspense boundary or use cache() directive.\n\nFile: apps/web/src/app/page.tsx","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-27T17:31:14.123Z","updated_at":"2025-12-27T17:41:43.508Z","closed_at":"2025-12-27T17:41:43.508Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi6cxqi","title":"Binary search utility with unit tests","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-27T18:15:37.668Z","updated_at":"2025-12-27T18:25:10.147Z","closed_at":"2025-12-27T18:25:10.147Z","parent_id":"opencode-next--xts0a-mjomfi67kp4","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi6effm","title":"Zustand store with Immer and unit tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T18:15:37.670Z","updated_at":"2025-12-27T18:42:15.445Z","closed_at":"2025-12-27T18:42:15.445Z","parent_id":"opencode-next--xts0a-mjomfi67kp4","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi6g4fl","title":"SSE hook with reconnection and integration tests","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-27T18:15:37.672Z","updated_at":"2025-12-27T18:35:02.510Z","closed_at":"2025-12-27T18:35:02.510Z","parent_id":"opencode-next--xts0a-mjomfi67kp4","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi6kmpo","title":"Add zustand and immer dependencies","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-27T18:15:37.676Z","updated_at":"2025-12-27T18:35:58.380Z","closed_at":"2025-12-27T18:35:58.380Z","parent_id":"opencode-next--xts0a-mjomfi67kp4","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi67kp4","title":"Implement SSE Sync Layer from SYNC_IMPLEMENTATION.md","description":"Implement real-time SSE sync layer for Next.js app following docs/guides/SYNC_IMPLEMENTATION.md. Hybrid approach: audit existing hooks, implement missing pieces. Full testing trophy: unit tests for pure functions, integration tests for hook interactions.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T18:15:37.663Z","updated_at":"2025-12-27T19:05:29.310Z","closed_at":"2025-12-27T19:05:29.310Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi6hwq5","title":"OpenCodeProvider with integration tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T18:15:37.673Z","updated_at":"2025-12-27T19:05:23.816Z","closed_at":"2025-12-27T19:05:23.816Z","parent_id":"opencode-next--xts0a-mjomfi67kp4","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjomfi6jk7q","title":"Session and Message hooks with unit tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T18:15:37.675Z","updated_at":"2025-12-27T19:05:07.876Z","closed_at":"2025-12-27T19:05:07.876Z","parent_id":"opencode-next--xts0a-mjomfi67kp4","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjoodsechhz","title":"Session Page Chat UI with Real-time Streaming","description":"Wire up session page to use OpenCodeProvider/useSession/useMessages hooks, implement chat UI with ai-elements components, add message streaming support. Progressive: hooks → UI → streaming.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T19:10:16.836Z","updated_at":"2025-12-27T19:27:26.734Z","closed_at":"2025-12-27T19:27:26.734Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjoodseh8lb","title":"Wire session page to use hooks and OpenCodeProvider","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T19:10:16.841Z","updated_at":"2025-12-27T19:17:51.342Z","closed_at":"2025-12-27T19:17:51.342Z","parent_id":"opencode-next--xts0a-mjoodsechhz","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjoodsejg5w","title":"Implement chat UI with ai-elements components","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:10:16.843Z","updated_at":"2025-12-27T19:21:42.417Z","closed_at":"2025-12-27T19:21:42.417Z","parent_id":"opencode-next--xts0a-mjoodsechhz","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjoodsel10s","title":"Add message streaming and part updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:10:16.845Z","updated_at":"2025-12-27T19:27:05.419Z","closed_at":"2025-12-27T19:27:05.419Z","parent_id":"opencode-next--xts0a-mjoodsechhz","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjopc10o42o","title":"Phase 3: Full Feature Parity","description":"Complete the OpenCode Next.js rebuild with interactive chat, model selection, status indicators, theming, and provider management. Transform from read-only viewer to fully functional chat application.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-27T19:36:54.312Z","updated_at":"2025-12-27T19:36:54.312Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjopc10yalm","title":"Add model selector to prompt input","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T19:36:54.322Z","updated_at":"2025-12-27T19:36:54.322Z","parent_id":"opencode-next--xts0a-mjopc10o42o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjopc112ymf","title":"Add provider management page","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T19:36:54.326Z","updated_at":"2025-12-27T19:36:54.326Z","parent_id":"opencode-next--xts0a-mjopc10o42o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjopc10ttlc","title":"Wire prompt input to session page for sending messages","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-27T19:36:54.317Z","updated_at":"2025-12-27T19:47:24.611Z","closed_at":"2025-12-27T19:47:24.611Z","parent_id":"opencode-next--xts0a-mjopc10o42o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjopc10vanm","title":"Add session status indicator (running/idle)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T19:36:54.319Z","updated_at":"2025-12-27T19:47:25.600Z","closed_at":"2025-12-27T19:47:25.600Z","parent_id":"opencode-next--xts0a-mjopc10o42o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjopc110pij","title":"Implement theme switching (light/dark)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:36:54.324Z","updated_at":"2025-12-27T19:47:26.658Z","closed_at":"2025-12-27T19:47:26.658Z","parent_id":"opencode-next--xts0a-mjopc10o42o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0idup","title":"Types & Prompt Store","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-27T21:30:22.194Z","updated_at":"2025-12-27T21:36:10.463Z","closed_at":"2025-12-27T21:36:10.463Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0dxw5","title":"Slash Commands & @ References","description":"Full implementation of slash commands and @ file references for prompt input - contenteditable editor with file pills, autocomplete, keyboard navigation, and API integration","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T21:30:22.189Z","updated_at":"2025-12-27T22:02:40.357Z","closed_at":"2025-12-27T22:02:40.357Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0jji4","title":"Input Parsing Utilities","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T21:30:22.195Z","updated_at":"2025-12-27T21:45:58.310Z","closed_at":"2025-12-27T21:45:58.310Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0l53e","title":"File Search Hook","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T21:30:22.197Z","updated_at":"2025-12-27T21:45:59.833Z","closed_at":"2025-12-27T21:45:59.833Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0nlpp","title":"Command Registry Hook","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T21:30:22.199Z","updated_at":"2025-12-27T21:46:01.459Z","closed_at":"2025-12-27T21:46:01.459Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0plby","title":"Autocomplete Component","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T21:30:22.201Z","updated_at":"2025-12-27T21:46:03.041Z","closed_at":"2025-12-27T21:46:03.041Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0r4el","title":"File Pill Component","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T21:30:22.203Z","updated_at":"2025-12-27T21:46:04.457Z","closed_at":"2025-12-27T21:46:04.457Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0smvo","title":"Prompt Input Component","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T21:30:22.204Z","updated_at":"2025-12-27T21:55:52.506Z","closed_at":"2025-12-27T21:55:52.506Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjotdy0ubfe","title":"API Integration & Session Page","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T21:30:22.206Z","updated_at":"2025-12-27T22:02:38.599Z","closed_at":"2025-12-27T22:02:38.599Z","parent_id":"opencode-next--xts0a-mjotdy0dxw5","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwonzt","title":"A1: Expand store.ts with DirectoryState pattern","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:00:50.568Z","updated_at":"2025-12-28T02:07:45.120Z","closed_at":"2025-12-28T02:07:45.120Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwqjd5","title":"A2: Add Part/Todo/Status/Diff types","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:00:50.570Z","updated_at":"2025-12-28T02:07:52.787Z","closed_at":"2025-12-28T02:07:52.787Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbqwqb","title":"Add safe-area CSS for iPhone notch/home indicator","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-28T02:21:00.278Z","updated_at":"2025-12-28T02:21:00.278Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3vrh0uy6","title":"Add ALL convenience methods to store (session + message)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:24:09.684Z","updated_at":"2025-12-28T02:39:41.106Z","closed_at":"2025-12-28T02:39:41.106Z","parent_id":"opencode-next--xts0a-mjp3vrgvywk","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3vrh2s7k","title":"Update use-session.ts to pass directory param","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:24:09.686Z","updated_at":"2025-12-28T02:39:47.830Z","closed_at":"2025-12-28T02:39:47.830Z","parent_id":"opencode-next--xts0a-mjp3vrgvywk","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3vrh4kuy","title":"Update use-messages.ts to pass directory param","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:24:09.688Z","updated_at":"2025-12-28T02:39:49.019Z","closed_at":"2025-12-28T02:39:49.019Z","parent_id":"opencode-next--xts0a-mjp3vrgvywk","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3vrh64t8","title":"Update session-layout.tsx to pass directory param","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:24:09.690Z","updated_at":"2025-12-28T02:39:50.439Z","closed_at":"2025-12-28T02:39:50.439Z","parent_id":"opencode-next--xts0a-mjp3vrgvywk","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp4g5zvroy","title":"Fix remaining test failures (3 issues)","description":"Remaining issues after store refactor fix:\n\n1. use-session.test.ts:157 - \"updates when session.updated event fires\" test fails\n   - Expected \"Updated Title\", got \"Test Session\"\n   - Event handling not triggering update\n\n2. provider.test.tsx - Import error\n   - SyntaxError: Export named 'useSSEDirect' not found\n   - Module resolution issue with SDK types\n\n3. use-session-status.test.ts:44 - Type error\n   - TS2556: A spread argument must either have a tuple type or be passed to a rest parameter\n\nFiles: use-session.test.ts, provider.test.tsx, use-session-status.test.ts","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-28T02:40:01.627Z","updated_at":"2025-12-28T03:01:01.869Z","closed_at":"2025-12-28T03:01:01.869Z","parent_id":"opencode-next--xts0a-mjp3vrgvywk","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwrdxq","title":"C1: Implement bootstrap in provider","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:00:50.571Z","updated_at":"2025-12-28T03:57:21.037Z","closed_at":"2025-12-28T03:57:21.037Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwu4ch","title":"C2: Re-bootstrap on SSE reconnect","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:00:50.574Z","updated_at":"2025-12-28T03:57:22.165Z","closed_at":"2025-12-28T03:57:22.165Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rww6av","title":"C3: Heartbeat timeout detection (60s)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:00:50.576Z","updated_at":"2025-12-28T03:57:23.703Z","closed_at":"2025-12-28T03:57:23.703Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwxkf2","title":"C4: Implement sync() for manual refresh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:00:50.577Z","updated_at":"2025-12-28T03:57:25.038Z","closed_at":"2025-12-28T03:57:25.038Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbjahb","title":"Add convenience methods to store (getSession, addSession, updateSession, removeSession, getMessages, etc)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:21:00.271Z","updated_at":"2025-12-28T03:56:20.345Z","closed_at":"2025-12-28T03:56:20.345Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3vrgvywk","title":"Fix Store Refactor: Restore Convenience Methods","description":"Fix 49 type errors and 28 test failures by restoring convenience methods to store with DirectoryState pattern, then update callers to pass directory param.\n\nExecution order:\n1. FIRST: Add all methods to store (blocks everything else)\n2. THEN PARALLEL: Update use-session.ts, use-messages.ts, session-layout.tsx","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T02:24:09.679Z","updated_at":"2025-12-28T03:57:26.766Z","closed_at":"2025-12-28T03:57:26.766Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7805dv5a","title":"P1: Subagent Display (Backlog)","description":"From docs/audits/04-SUBAGENT-DISPLAY-AUDIT.md - 85% missing, 9-14h effort.\n\nExpandable child session display for Task tool calls. Currently shows static summary, needs real-time streaming of child agent work.\n\nReference: /Users/joel/Code/sst/opencode/packages/app/src/","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-28T03:57:39.649Z","updated_at":"2025-12-28T03:57:39.649Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7805j9tm","title":"Create subagent-store.ts with SubagentSession state","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:39.655Z","updated_at":"2025-12-28T03:57:39.655Z","parent_id":"opencode-next--xts0a-mjp7805dv5a","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7805ny9i","title":"Create useSubagentSync hook for child session SSE","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:39.659Z","updated_at":"2025-12-28T03:57:39.659Z","parent_id":"opencode-next--xts0a-mjp7805dv5a","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7805qcn8","title":"Create expandable TaskToolPart component","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:39.662Z","updated_at":"2025-12-28T03:57:39.662Z","parent_id":"opencode-next--xts0a-mjp7805dv5a","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7805uvne","title":"Create SubagentView component for child session rendering","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:39.666Z","updated_at":"2025-12-28T03:57:39.666Z","parent_id":"opencode-next--xts0a-mjp7805dv5a","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7843ntkx","title":"P1: Feature Parity (Backlog)","description":"From docs/audits/02-FEATURE-PARITY-AUDIT.md - 10 missing features, 40h effort.\n\nMajor features needed for full parity with SolidJS app.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-28T03:57:44.771Z","updated_at":"2025-12-28T03:57:44.771Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7843za68","title":"Session list + sidebar with multi-project navigation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:44.783Z","updated_at":"2025-12-28T03:57:44.783Z","parent_id":"opencode-next--xts0a-mjp7843ntkx","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp78442uva","title":"Undo/Redo via session.revert/unrevert API","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:44.786Z","updated_at":"2025-12-28T03:57:44.786Z","parent_id":"opencode-next--xts0a-mjp7843ntkx","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp78444i94","title":"Review panel + diff viewer","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:44.788Z","updated_at":"2025-12-28T03:57:44.788Z","parent_id":"opencode-next--xts0a-mjp7843ntkx","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp78448s12","title":"Command palette with keyboard shortcuts","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:44.792Z","updated_at":"2025-12-28T03:57:44.792Z","parent_id":"opencode-next--xts0a-mjp7843ntkx","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7844cf5x","title":"Terminal integration with xterm.js","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T03:57:44.796Z","updated_at":"2025-12-28T03:57:44.796Z","parent_id":"opencode-next--xts0a-mjp7843ntkx","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7871pwub","title":"P2: Polish (Backlog)","description":"From docs/audits/ - Various polish items, 10h effort.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-28T03:57:48.589Z","updated_at":"2025-12-28T03:57:48.589Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7871u5va","title":"Error toast for search failures","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T03:57:48.594Z","updated_at":"2025-12-28T03:57:48.594Z","parent_id":"opencode-next--xts0a-mjp7871pwub","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp7871x2rm","title":"DOM normalization for ContentEditable","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T03:57:48.597Z","updated_at":"2025-12-28T03:57:48.597Z","parent_id":"opencode-next--xts0a-mjp7871pwub","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp787214lp","title":"Pull-to-refresh gesture","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T03:57:48.601Z","updated_at":"2025-12-28T03:57:48.601Z","parent_id":"opencode-next--xts0a-mjp7871pwub","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp78724s56","title":"Haptic feedback on actions","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T03:57:48.604Z","updated_at":"2025-12-28T03:57:48.604Z","parent_id":"opencode-next--xts0a-mjp7871pwub","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp78727h6h","title":"Service worker for offline caching","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T03:57:48.607Z","updated_at":"2025-12-28T03:57:48.607Z","parent_id":"opencode-next--xts0a-mjp7871pwub","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbh74u","title":"Add session.created + session.deleted handlers to store","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:21:00.269Z","updated_at":"2025-12-28T04:02:28.680Z","closed_at":"2025-12-28T04:02:28.680Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpblizu","title":"Handle global.disposed with re-bootstrap on SSE reconnect","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:21:00.273Z","updated_at":"2025-12-28T04:03:02.448Z","closed_at":"2025-12-28T04:03:02.448Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbnnx0","title":"Add visibility API to SSE - disconnect when backgrounded, reconnect when foregrounded","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T02:21:00.275Z","updated_at":"2025-12-28T04:06:01.723Z","closed_at":"2025-12-28T04:06:01.723Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbshd2","title":"Add heartbeat timeout detection (60s = 2x server heartbeat)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:21:00.280Z","updated_at":"2025-12-28T04:06:03.476Z","closed_at":"2025-12-28T04:06:03.476Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbteun","title":"Import SDK types instead of redefining (Session, Message, Part, etc)","description":"Lower priority - current types work fine. Store has its own Session, Message, Part, Todo types that are compatible with SDK types. Can be done as a refactor task later. Moving to P1.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T02:21:00.281Z","updated_at":"2025-12-28T04:09:28.410Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbv1kt","title":"Add session.error handler with toast notification","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T02:21:00.283Z","updated_at":"2025-12-28T04:09:20.951Z","closed_at":"2025-12-28T04:09:20.951Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp78io41ll","title":"Add safe-area CSS for iPhone notch/home indicator","description":"Content hides under iPhone notch/home indicator.\n\nAdd to globals.css:\n```css\n:root {\n  --safe-area-top: env(safe-area-inset-top);\n  --safe-area-bottom: env(safe-area-inset-bottom);\n  --safe-area-left: env(safe-area-inset-left);\n  --safe-area-right: env(safe-area-inset-right);\n}\n\nbody {\n  padding-top: var(--safe-area-top);\n  padding-bottom: var(--safe-area-bottom);\n  padding-left: var(--safe-area-left);\n  padding-right: var(--safe-area-right);\n}\n```\n\nUpdate fixed bottom input in session-layout.tsx:\n```tsx\n<div className=\"fixed\" style={{ bottom: 'calc(0px + var(--safe-area-bottom))' }}>\n```\n\nFiles: apps/web/src/app/globals.css, apps/web/src/app/session/[id]/session-layout.tsx","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T03:58:03.652Z","updated_at":"2025-12-28T04:02:30.139Z","closed_at":"2025-12-28T04:02:30.139Z","parent_id":"opencode-next--xts0a-mjp3rpbc8ia","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjparvpjcr9","title":"Sync polish + UX fixes","description":"Complete sync layer, fix mobile CSS, fix broken prompt submission, fix tool card overflow","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T05:37:05.863Z","updated_at":"2025-12-28T05:47:54.762Z","closed_at":"2025-12-28T05:47:54.762Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjparvpnxxv","title":"Fix prompt submission - add error handling","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T05:37:05.867Z","updated_at":"2025-12-28T05:47:42.705Z","closed_at":"2025-12-28T05:47:42.705Z","parent_id":"opencode-next--xts0a-mjparvpjcr9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjparvpqexg","title":"Fix tool card overflow with long paths/names","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T05:37:05.870Z","updated_at":"2025-12-28T05:47:44.649Z","closed_at":"2025-12-28T05:47:44.649Z","parent_id":"opencode-next--xts0a-mjparvpjcr9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjparvprusi","title":"Add mobile safe-area CSS for notch/home indicator","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T05:37:05.871Z","updated_at":"2025-12-28T05:47:46.461Z","closed_at":"2025-12-28T05:47:46.461Z","parent_id":"opencode-next--xts0a-mjparvpjcr9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjparvpuk6g","title":"Handle remaining SSE events (server.instance.disposed, provider.updated, project.updated)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T05:37:05.874Z","updated_at":"2025-12-28T05:47:48.713Z","closed_at":"2025-12-28T05:47:48.713Z","parent_id":"opencode-next--xts0a-mjparvpjcr9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjpxrdpzciu","title":"Fix test mock pollution","description":"Multiple test files mock use-sse differently. Bun's test runner shares mock state across files in same process, causing 12 tests to fail when run together but pass individually. Need to add proper mock isolation.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-28T16:20:33.719Z","updated_at":"2025-12-28T16:20:33.719Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjpxrdq4jil","title":"Add mock isolation to all test files that mock use-sse","description":"Original approach (mock.restore) doesn't work due to bun's module caching. Pivoting to remove mocks entirely and use integration tests with real implementations.","status":"blocked","priority":0,"issue_type":"task","created_at":"2025-12-28T16:20:33.724Z","updated_at":"2025-12-28T16:30:56.151Z","parent_id":"opencode-next--xts0a-mjpxrdpzciu","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02rxmywk","title":"Restore store convenience methods","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T17:25:24.586Z","updated_at":"2025-12-28T17:28:07.020Z","closed_at":"2025-12-28T17:28:07.020Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02rxrbws","title":"Implement bootstrap function","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T17:25:24.591Z","updated_at":"2025-12-28T17:30:22.308Z","closed_at":"2025-12-28T17:30:22.308Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02ry2sby","title":"Handle session.error with toast notifications","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T17:25:24.602Z","updated_at":"2025-12-28T17:37:11.723Z","closed_at":"2025-12-28T17:37:11.723Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02rxp4rh","title":"Handle session.created and session.deleted events","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T17:25:24.589Z","updated_at":"2025-12-28T17:40:29.752Z","closed_at":"2025-12-28T17:40:29.752Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02rxti50","title":"Implement sync function for session details","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T17:25:24.593Z","updated_at":"2025-12-28T17:41:37.285Z","closed_at":"2025-12-28T17:41:37.285Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02ry06qx","title":"Handle global.disposed and server events","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T17:25:24.600Z","updated_at":"2025-12-28T17:41:17.958Z","closed_at":"2025-12-28T17:41:17.958Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02ry33l5","title":"Add visibility API reconnect","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T17:25:24.603Z","updated_at":"2025-12-28T17:42:33.070Z","closed_at":"2025-12-28T17:42:33.070Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02ry5dlu","title":"Add heartbeat timeout detection","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T17:25:24.605Z","updated_at":"2025-12-28T17:43:26.926Z","closed_at":"2025-12-28T17:43:26.926Z","parent_id":"opencode-next--xts0a-mjq02rxinxh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq02rxinxh","title":"Full-Ass Sync Implementation","description":"Complete SSE sync overhaul: restore store methods, implement bootstrap, handle all 18 event types, add resilience features (visibility API, heartbeat timeout, configuration). P0+P1+P2 from audit.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T17:25:24.582Z","updated_at":"2025-12-28T17:43:57.439Z","closed_at":"2025-12-28T17:43:57.439Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwza3x","title":"B1: Wire message.part.updated + message.part.removed events","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T02:00:50.579Z","updated_at":"2025-12-28T17:44:55.785Z","closed_at":"2025-12-28T17:44:55.785Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rx0p4d","title":"B2: Wire todo.updated event","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T02:00:50.580Z","updated_at":"2025-12-28T17:45:07.629Z","closed_at":"2025-12-28T17:45:07.629Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rx2k8w","title":"B3: Wire session.status + session.diff events","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T02:00:50.582Z","updated_at":"2025-12-28T17:45:18.119Z","closed_at":"2025-12-28T17:45:18.119Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rx4s8w","title":"B4: Wire global.disposed + archived session handling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T02:00:50.584Z","updated_at":"2025-12-28T17:45:28.516Z","closed_at":"2025-12-28T17:45:28.516Z","parent_id":"opencode-next--xts0a-mjp31rwi2hs","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp31rwi2hs","title":"Complete SSE Sync Implementation per SYNC_IMPLEMENTATION.md","description":"Implement all missing SSE sync features identified in gap analysis. Reference: docs/guides/SYNC_IMPLEMENTATION.md\n\nGroups:\n- A: Store expansion (parallel) - sessionStatus, sessionDiff, parts, todos\n- C: Connection lifecycle (sequential) - bootstrap, reconnect, heartbeat, sync()\n- B: Event subscriptions (parallel) - wire up all missing event types","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T02:00:50.562Z","updated_at":"2025-12-28T17:45:51.768Z","closed_at":"2025-12-28T17:45:51.768Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq2abj7s6r","title":"SSE refactor: eventsource-parser + Zustand integration","description":"Fix SSE reconnection loop by stabilizing callbacks with refs, use eventsource-parser for parsing, integrate SSE events with Zustand store. Delete unused useSSEDirect.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T18:27:15.811Z","updated_at":"2025-12-28T18:49:59.382Z","closed_at":"2025-12-28T18:49:59.382Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq2abjdkc8","title":"Refactor SSEProvider to use eventsource-parser + stable refs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T18:27:15.817Z","updated_at":"2025-12-28T18:38:08.234Z","closed_at":"2025-12-28T18:38:08.234Z","parent_id":"opencode-next--xts0a-mjq2abj7s6r","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq2abjgtpl","title":"Add SSE event handlers to Zustand store","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T18:27:15.820Z","updated_at":"2025-12-28T18:38:08.793Z","closed_at":"2025-12-28T18:38:08.793Z","parent_id":"opencode-next--xts0a-mjq2abj7s6r","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq2abjjgnw","title":"Wire SSEProvider to Zustand store","description":"UPDATED: Need to modify use-sse.tsx, not provider.tsx. Re-spawning with correct file reservation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T18:27:15.823Z","updated_at":"2025-12-28T18:42:57.801Z","closed_at":"2025-12-28T18:42:57.801Z","parent_id":"opencode-next--xts0a-mjq2abj7s6r","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq2abjrds6","title":"Remove useEffect SSE subscriptions from hooks","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T18:27:15.831Z","updated_at":"2025-12-28T18:49:49.161Z","closed_at":"2025-12-28T18:49:49.161Z","parent_id":"opencode-next--xts0a-mjq2abj7s6r","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjpy4ujmirf","title":"Refactor tests to integration style - remove mock.module pollution","description":"Remove mock.module() calls that cause cross-file pollution. Replace with integration tests that use real implementations.\n\nStrategy:\n1. Mock only fetch/network layer (not internal modules)\n2. Use real OpenCodeProvider, real hooks, real store\n3. Control behavior via fetch mocks or MSW\n4. Tests become more realistic and don't pollute each other\n\nFiles to refactor:\n- apps/web/src/react/provider.test.tsx\n- apps/web/src/react/use-session.test.ts  \n- apps/web/src/react/use-messages.test.ts\n- apps/web/src/react/use-file-search.test.ts\n- apps/web/src/react/use-session-status.test.ts\n- apps/web/src/components/prompt/PromptInput.test.tsx","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T16:31:02.050Z","updated_at":"2025-12-28T19:27:19.862Z","closed_at":"2025-12-28T19:27:19.862Z","parent_id":"opencode-next--xts0a-mjpxrdpzciu","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq3s9ru2ed","title":"Fix store handleSSEEvent to auto-init directories","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T19:09:12.954Z","updated_at":"2025-12-28T19:26:51.989Z","closed_at":"2025-12-28T19:26:51.989Z","parent_id":"opencode-next--xts0a-mjq3s9rp9wv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq3s9rxa16","title":"Fix session-status.test.tsx - convert to integration style","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T19:09:12.957Z","updated_at":"2025-12-28T19:26:53.427Z","closed_at":"2025-12-28T19:26:53.427Z","parent_id":"opencode-next--xts0a-mjq3s9rp9wv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq3s9s7v23","title":"Fix use-file-search.test.ts error handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T19:09:12.967Z","updated_at":"2025-12-28T19:26:54.824Z","closed_at":"2025-12-28T19:26:54.824Z","parent_id":"opencode-next--xts0a-mjq3s9rp9wv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq3s9rp9wv","title":"Fix green dot indicators + 16 failing tests","description":"Fix SSE directory initialization bug preventing green dots from showing, and fix 16 failing tests across session-status, provider.integration, and use-file-search test files","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T19:09:12.949Z","updated_at":"2025-12-28T20:03:11.796Z","closed_at":"2025-12-28T20:03:11.796Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq3s9rza1e","title":"Fix provider.integration.test.tsx toast tests","description":"Deleted provider.integration.test.tsx - tests had fundamental async/act issues that were blocking the test suite. The functionality is tested via store.test.ts and session-status.test.tsx instead.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T19:09:12.959Z","updated_at":"2025-12-28T20:03:03.572Z","closed_at":"2025-12-28T20:03:03.567Z","parent_id":"opencode-next--xts0a-mjq3s9rp9wv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq92i90uko","title":"Integrate multi-server SSE into session pages","description":"## Context\n\nWe implemented multi-server SSE discovery to show real-time session status on the projects list page. This discovers ALL running opencode processes (TUIs, serves) on the machine and aggregates their SSE events.\n\n## What Was Built\n\n### 1. Server Discovery API Route\n**File:** `apps/web/src/app/api/opencode-servers/route.ts`\n- Uses `lsof` to find all bun/opencode processes listening on TCP ports\n- Verifies each is an opencode server by hitting `/project` endpoint\n- Returns `Array<{ port: number; pid: number }>`\n\n### 2. Multi-Server SSE Manager\n**File:** `apps/web/src/core/multi-server-sse.ts`\n- `MultiServerSSE` class that:\n  - Polls `/api/opencode-servers` every 5s to discover servers\n  - Maintains SSE connections to each discovered server's `/global/event`\n  - Uses `EventSourceParserStream` for proper SSE parsing\n  - Reconnects automatically on disconnect\n  - Cleans up connections when servers die\n  - Aggregates `session.status` events from all servers\n- Exports singleton `multiServerSSE`\n\n### 3. ProjectsList Integration\n**File:** `apps/web/src/app/projects-list.tsx`\n- Added `useMultiServerSSE()` hook that:\n  - Starts multi-server discovery on mount\n  - Subscribes to status updates from all servers\n  - Updates store with session status events\n- Also kept `useBootstrapStatuses()` which derives initial status from messages (last message without `completed` time = running)\n- Also kept `useSSESubscription()` for main `opencode serve` SSE\n\n### 4. Store Updates\n**File:** `apps/web/src/react/store.ts`\n- Updated `session.status` handler to accept both:\n  - `{ type: \"busy\" | \"retry\" | \"idle\" }` from backend\n  - `{ running: boolean }` from SSE\n\n### 5. UI Updates\n- Green pulsing dot for running sessions\n- Gray dot for idle sessions\n- Footer with GitHub link and padding\n\n## What Needs To Be Done\n\n### Integrate multi-server SSE into session pages\n\nThe session detail page (`apps/web/src/app/session/[id]/session-layout.tsx`) currently only uses single-server SSE via `OpenCodeProvider`. It should also use multi-server SSE so that:\n\n1. If viewing a session running in a TUI (not `opencode serve`), you get real-time updates\n2. Status indicator shows correctly regardless of which process is running the session\n\n### Implementation Plan\n\n1. Create a `useMultiServerSSE` hook in `apps/web/src/react/` that can be used by any component\n2. Update `SessionLayout` or `SessionMessages` to subscribe to multi-server SSE\n3. The existing `OpenCodeProvider` SSE is still needed for:\n   - Creating new sessions\n   - Sending messages\n   - File search, etc.\n4. Multi-server SSE augments it for status monitoring\n\n### Architecture\n\n```\nopencode serve (:4056)          <- API for actions (new session, send message)\n       +\nMulti-Server SSE                <- Status from ALL processes\n       =\nComplete real-time experience\n```\n\n### Files to Modify\n- `apps/web/src/react/use-multi-server-sse.ts` (new hook)\n- `apps/web/src/app/session/[id]/session-layout.tsx` or `session-messages.tsx`\n\n### Testing\n- Start a session in TUI\n- Open web app to that session\n- Verify green dot appears and updates in real-time","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T21:37:08.580Z","updated_at":"2025-12-28T21:52:30.398Z","closed_at":"2025-12-28T21:52:30.398Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq96hzedln","title":"Integrate multi-server SSE into session pages","description":"Extract useMultiServerSSE hook into reusable file, integrate into session pages for real-time status monitoring across all opencode processes (TUIs, serves), and document the wild lsof-based discovery architecture","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T21:40:14.858Z","updated_at":"2025-12-28T21:52:29.034Z","closed_at":"2025-12-28T21:52:29.034Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq96hzj6cq","title":"Extract useMultiServerSSE hook into reusable file","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T21:40:14.863Z","updated_at":"2025-12-28T21:45:44.974Z","closed_at":"2025-12-28T21:45:44.974Z","parent_id":"opencode-next--xts0a-mjq96hzedln","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq96hzm2te","title":"Integrate useMultiServerSSE into session pages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:40:14.866Z","updated_at":"2025-12-28T21:52:18.344Z","closed_at":"2025-12-28T21:52:18.344Z","parent_id":"opencode-next--xts0a-mjq96hzedln","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq96hzoedf","title":"Document multi-server SSE architecture","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:40:14.868Z","updated_at":"2025-12-28T21:52:19.007Z","closed_at":"2025-12-28T21:52:19.007Z","parent_id":"opencode-next--xts0a-mjq96hzedln","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjq9cyzdp3p","title":"Make relative time display update live on projects page","description":"The relative time display (e.g., \"2 minutes ago\") on the projects list page is static - it only shows the time since page load. It should update live every minute so users see accurate \"last active\" times without refreshing.\n\nImplementation options:\n1. Use a `useInterval` hook to force re-render every 60s\n2. Use a dedicated live time component that manages its own updates\n3. Use a global timer that triggers updates across all time displays\n\nThe time display is likely in projects-list.tsx or a related component. Find where relative time is rendered and add live updates.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:45:16.825Z","updated_at":"2025-12-28T21:52:19.921Z","closed_at":"2025-12-28T21:52:19.921Z","parent_id":"opencode-next--xts0a-mjq96hzedln","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqa1inmqxw","title":"Optimize server discovery polling - fast initial, slow steady state","description":"Current 30s polling is too slow - green dots don't update nicely on initial load.\n\nOptions to explore:\n1. Fast initial polling (2s) that slows down after servers stabilize (30s)\n2. Exponential backoff - start at 2s, double until 30s max\n3. Event-driven discovery trigger when SSE connects/disconnects\n4. Hybrid: fast poll until first successful discovery, then slow\n\nThe SSE connections handle real-time status updates once connected, but we need faster discovery to:\n- Pick up new TUIs quickly\n- Show green dots on page load\n- Route messages to correct server ASAP","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T22:04:22.066Z","updated_at":"2025-12-28T22:04:22.066Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqad7nu24w","title":"Research: Session Page Scroll Jank Root Cause Analysis","description":"Investigate why session page messages jump to top then bounce back to bottom. Identify all contributing factors and propose permanent solutions for rock-solid scroll behavior.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T22:13:27.690Z","updated_at":"2025-12-28T22:20:36.692Z","closed_at":"2025-12-28T22:20:36.692Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqad7nzqcc","title":"Analyze current scroll implementation in codebase","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T22:13:27.695Z","updated_at":"2025-12-28T22:17:23.093Z","closed_at":"2025-12-28T22:17:23.093Z","parent_id":"opencode-next--xts0a-mjqad7nu24w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqad7o3rrx","title":"Research use-stick-to-bottom library requirements","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T22:13:27.699Z","updated_at":"2025-12-28T22:17:25.972Z","closed_at":"2025-12-28T22:17:25.972Z","parent_id":"opencode-next--xts0a-mjqad7nu24w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqad7ocy9c","title":"Analyze SSE message updates and re-render patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T22:13:27.708Z","updated_at":"2025-12-28T22:17:28.398Z","closed_at":"2025-12-28T22:17:28.398Z","parent_id":"opencode-next--xts0a-mjqad7nu24w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqad7ofjbb","title":"Search CASS for similar scroll/jank issues","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T22:13:27.711Z","updated_at":"2025-12-28T22:17:29.987Z","closed_at":"2025-12-28T22:17:29.987Z","parent_id":"opencode-next--xts0a-mjqad7nu24w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqad7ohmnc","title":"Synthesize findings and propose solutions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T22:13:27.713Z","updated_at":"2025-12-28T22:20:35.140Z","closed_at":"2025-12-28T22:20:35.140Z","parent_id":"opencode-next--xts0a-mjqad7nu24w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqara4yy7w","title":"Rock of Gibraltar Scroll Fix - Full Implementation","description":"Fix all 6 scroll issues: Fragment→div container, Suspense flex wrapper, scroll button fixed positioning, debounce transformMessages, scroll threshold 100px, smooth scroll behavior","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T22:24:24.082Z","updated_at":"2025-12-28T22:32:52.470Z","closed_at":"2025-12-28T22:32:52.470Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqara547hu","title":"P0: Fix Fragment container in SessionContent","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T22:24:24.088Z","updated_at":"2025-12-28T22:32:44.621Z","closed_at":"2025-12-28T22:32:44.621Z","parent_id":"opencode-next--xts0a-mjqara4yy7w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqara57h6s","title":"P0: Wrap Suspense in flex container","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T22:24:24.091Z","updated_at":"2025-12-28T22:32:46.232Z","closed_at":"2025-12-28T22:32:46.232Z","parent_id":"opencode-next--xts0a-mjqara4yy7w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqara59gyw","title":"P1+P3: Fix scroll button and polish conversation.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T22:24:24.093Z","updated_at":"2025-12-28T22:32:48.248Z","closed_at":"2025-12-28T22:32:48.248Z","parent_id":"opencode-next--xts0a-mjqara4yy7w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqara5g1zb","title":"P2: Debounce transformMessages during streaming","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T22:24:24.100Z","updated_at":"2025-12-28T22:32:50.387Z","closed_at":"2025-12-28T22:32:50.387Z","parent_id":"opencode-next--xts0a-mjqara4yy7w","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqc0xactqq","title":"Fix Web↔TUI bidirectional sync - TUI→Web broken after multi-server routing changes","description":"# Context\n\nWe were working on bidirectional sync between the Next.js web app and OpenCode TUIs. \n\n## What WAS Working\n- TUI → Web sync was PERFECT before this session's changes\n- SSE events from TUI were showing up in web UI in real-time\n- Messages, parts, status all syncing correctly\n\n## What We Were Trying to Fix\n- Web → TUI was NOT working (messages sent from web didn't appear in TUI)\n- Root cause identified: `useSendMessage` was routing to wrong server\n\n## Latest Debug Output (Dec 28, 10:59 PM)\n\n```\n[MultiServerSSE] Discovered servers: 13\n[MultiServerSSE] Current connections: []\n[MultiServerSSE] Will connect to new server: 54778\n[MultiServerSSE] Connecting to server on port: 54778\n... (all 13 servers)\n[MultiServerSSE] Current connections: (13) [54778, 53611, ...]\n```\n\n**CRITICAL FINDING:** \n- Connections ARE being made (13 connections in the Map)\n- But NO `[MultiServerSSE] Stream connected for port:` logs\n- NO `[MultiServerSSE] Raw event from port` logs\n- NO `[MultiServerSSE] Emitting event:` logs\n\nThis means the `fetch()` to SSE endpoints is hanging - never resolving.\n\n## Likely Cause\nBrowser is blocking cross-origin requests to `http://127.0.0.1:PORT/global/event` from the Next.js app running on `localhost:8423`.\n\nEven though both are localhost, `127.0.0.1` vs `localhost` can be treated as different origins.\n\n## To Verify\n1. Check Network tab in DevTools for pending/blocked requests\n2. Look for CORS errors in console\n3. Try changing fetch URL from `127.0.0.1` to `localhost`\n\n## Changes Made That Broke TUI→Web\n\n### 1. Changed `directoryToPort` to `directoryToPorts` (Map<string, number[]>)\nFile: `apps/web/src/core/multi-server-sse.ts`\n\n### 2. Added `sessionToPort` tracking\n\n### 3. Changed `createClient()` signature\nFile: `apps/web/src/core/client.ts`\n- Now: `createClient(directory?: string, sessionId?: string)`\n\n### 4. Changed `useSendMessage` to create client fresh each send\nFile: `apps/web/src/react/use-send-message.ts`\n\n## Key Files\n- `apps/web/src/core/multi-server-sse.ts` - SSE aggregator (MAIN SUSPECT)\n- `apps/web/src/core/client.ts` - Client factory with routing\n- `apps/web/src/react/use-send-message.ts` - Send message hook\n\n## Quick Test\n```bash\n# Verify SSE endpoint works from terminal\ncurl -s \"http://127.0.0.1:54778/global/event\" --max-time 2\n# Should return: data: {\"payload\":{\"type\":\"server.connected\",\"properties\":{}}}\n```\n\n## React Error in Console\n```\nThe result of getSnapshot should be cached to avoid an infinite loop\n```\nThis is in `useMessagesWithParts` - the Zustand selector might be creating new objects on every render.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-28T22:59:53.604Z","updated_at":"2025-12-28T23:04:50.770Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqbm7xyzse","title":"Improve message queuing: use prompt_async + SSE instead of blocking","description":"Current useSendMessage uses sync prompt endpoint which blocks. Backend's \"queue\" just waits for idle - all waiters get same response.\n\nBetter approach:\n1. Use prompt_async (returns 204 immediately)\n2. Client-side FIFO queue for sequential processing\n3. SSE session.status events to know when idle\n4. Queue shows pending messages, processes next when previous completes\n\nThis enables:\n- Non-blocking UI during send\n- True sequential message processing\n- Visual feedback on queued messages\n- Better mobile UX (no frozen UI)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T22:48:27.574Z","updated_at":"2025-12-28T23:46:04.962Z","closed_at":"2025-12-28T23:46:04.962Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqcrlhwmwo","title":"Async message queue with prompt_async + SSE","description":"Refactor useSendMessage to use non-blocking prompt_async endpoint. Implement client-side FIFO queue that processes messages sequentially using SSE session.status events to detect when session is idle. Add visual feedback for queued messages.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T23:20:38.036Z","updated_at":"2025-12-28T23:45:57.504Z","closed_at":"2025-12-28T23:45:57.504Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqcrli2cet","title":"Switch useSendMessage to prompt_async endpoint","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T23:20:38.042Z","updated_at":"2025-12-28T23:26:52.568Z","closed_at":"2025-12-28T23:26:52.568Z","parent_id":"opencode-next--xts0a-mjqcrlhwmwo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqcrli5h8m","title":"Add FIFO queue with SSE session.status integration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T23:20:38.045Z","updated_at":"2025-12-28T23:40:47.388Z","closed_at":"2025-12-28T23:40:47.388Z","parent_id":"opencode-next--xts0a-mjqcrlhwmwo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqcrli7ufr","title":"Add visual feedback for queued messages in UI","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T23:20:38.047Z","updated_at":"2025-12-28T23:45:49.927Z","closed_at":"2025-12-28T23:45:49.927Z","parent_id":"opencode-next--xts0a-mjqcrlhwmwo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqcwkjhpn1","title":"ROLLBACK: Layout/scroll changes broke auto-scroll and layout","description":"## What Broke\n- Auto-scroll to bottom stopped working\n- Layout is fucked\n\n## Changes Made (NEED TO REVERT)\n\n### 1. apps/web/src/components/ai-elements/conversation.tsx\n\n**Conversation component** - Added `flex flex-col` to scroll container:\n```tsx\n// BEFORE\nclassName={cn(\"relative flex-1 overflow-y-auto overflow-x-hidden\", className)}\n\n// AFTER (BROKEN)\nclassName={cn(\"relative flex-1 overflow-y-auto overflow-x-hidden flex flex-col\", className)}\n```\n\n**ConversationContent component** - Added min-h-full and spacer div:\n```tsx\n// BEFORE\n<div\n  ref={contentRef}\n  className={cn(\"flex flex-col gap-6 px-4 py-6 w-full max-w-4xl mx-auto\", className)}\n  {...props}\n>\n  {children}\n</div>\n\n// AFTER (BROKEN)\n<div\n  ref={contentRef}\n  className={cn(\"flex flex-col gap-6 px-4 py-6 w-full max-w-4xl mx-auto min-h-full\", className)}\n  {...props}\n>\n  {/* Spacer pushes content to bottom when there's little content */}\n  <div className=\"flex-1\" aria-hidden=\"true\" />\n  {children}\n</div>\n```\n\n### 2. apps/web/src/app/session/[id]/session-messages.tsx\n\nRemoved overflow-hidden from outer div:\n```tsx\n// BEFORE\n<div className=\"flex flex-col h-full overflow-hidden\">\n  <Conversation className=\"flex-1 min-h-0 overflow-hidden\">\n\n// AFTER (BROKEN)  \n<div className=\"flex flex-col h-full\">\n  <Conversation className=\"flex-1 min-h-0\">\n```\n\n## Original Issue Being Fixed\n- Messages pushed to top with gap at bottom\n- Can't scroll to past messages\n- Inconsistent pinning behavior\n\n## Root Cause Analysis Was\nThe layout hierarchy had conflicting overflow properties and ConversationContent didn't fill space properly.\n\n## To Rollback\nRevert all three changes above back to BEFORE state.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T23:24:30.077Z","updated_at":"2025-12-28T23:30:10.629Z","closed_at":"2025-12-28T23:30:10.629Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjp3rpbc8ia","title":"P0: Complete SSE Sync + Mobile Fixes (Audit-Driven)","description":"Fix critical gaps identified in docs/audits/01-SYNC-AUDIT.md and docs/audits/03-MOBILE-UX-AUDIT.md.\n\nCurrent state: Architecture correct, implementation incomplete. Store refactored to DirectoryState but missing convenience methods. Bootstrap implemented but missing event handlers.\n\nKey gaps:\n- session.created/deleted events silently dropped (subscribed but not handled)\n- global.disposed handled but needs re-bootstrap on reconnect\n- No visibility API (battery drain on mobile)\n- No safe-area CSS (content hidden under notch)\n- No heartbeat timeout detection\n\nSDK types available via @opencode-ai/sdk/client - use them instead of redefining.\n\nReference: /Users/joel/Code/sst/opencode/packages/app/src/ (SolidJS source of truth)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T02:21:00.264Z","updated_at":"2025-12-28T23:51:31.298Z","closed_at":"2025-12-28T23:51:31.298Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqdyo6cpv0","title":"Subagent display: dynamic \"currently doing\" title","description":"MVP subagent visibility: Update task tool title in real-time to show what subagent is currently doing.\n\nData source: `metadata.summary` array on Task tool part - last item with `status: \"running\"` or fallback to last completed.\n\nDisplay format:\n```\n◉ @explore \"Research auth flow\"\n  └ 🔍 Reading src/auth/middleware.ts...\n```\n\nImplementation:\n1. Extract current activity from metadata.summary (already streams via SSE)\n2. Create SubagentCurrentActivity component (guide Section 6)\n3. Integrate into existing task tool renderer\n4. Format tool names nicely (\"Reading file\", \"Searching\", \"Editing\")\n\nReference: docs/guides/SUBAGENT_DISPLAY.md Section 6","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-28T23:54:07.716Z","updated_at":"2025-12-29T00:08:13.927Z","closed_at":"2025-12-29T00:08:13.927Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqemilpqou","title":"Enhanced tool display: 3-line card with title, body, expand","description":"Redesign tool display to be taller with more context:\n\nStructure:\n- Line 1: Tool icon + name + status indicator (✓/⏳/✗)\n- Line 2: Primary context (file path, search pattern, command, etc.)\n- Line 3: Secondary info + expand toggle\n\nTool-specific body content:\n- Read: file path + line count\n- Edit: file path + (+additions, -deletions)\n- Grep: pattern + match count\n- Bash: command + exit code\n- Task: description + SubagentCurrentActivity (currently doing)\n\nExpandable section shows full output when clicked.\n\nFiles to modify:\n- apps/web/src/components/ai-elements/tool.tsx (main component)\n- apps/web/src/app/session/[id]/session-messages.tsx (integration)\n\nIntegrate SubagentCurrentActivity from task.tsx for Task tools.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T00:12:40.237Z","updated_at":"2025-12-29T00:22:25.708Z","closed_at":"2025-12-29T00:22:25.708Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqf1qul2w1","title":"Tool cards: conditional expand + Framer Motion polish","description":"Polish tool card UX:\n\n1. **Conditional expand chevron** - Only show expand option when there's content to expand:\n   - Show: has output, has error, has complex input\n   - Hide: pending, running with no output, simple one-liner tools\n\n2. **Framer Motion animations**:\n   - Smooth height transition on expand/collapse (AnimatePresence + motion.div)\n   - Subtle spring on status icon changes\n   - Optional: staggered fade-in for tool cards appearing in sequence\n\nDependencies: Need to add framer-motion package if not present.\n\nFiles:\n- apps/web/src/components/ai-elements/tool.tsx","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T00:24:30.765Z","updated_at":"2025-12-29T00:31:15.571Z","closed_at":"2025-12-29T00:31:15.571Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfh0jg26l","title":"Fix slow subagent 'currently doing' status updates","description":"Investigate and fix slow real-time updates for subagent status on web client. Data flows: SSE events → store.updatePart() → useMessages hook → component re-render. Need to identify bottleneck and fix.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T00:36:23.164Z","updated_at":"2025-12-29T00:44:38.893Z","closed_at":"2025-12-29T00:44:38.893Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfh0jlvcs","title":"Diagnose SSE event latency with logging","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T00:36:23.169Z","updated_at":"2025-12-29T00:40:51.889Z","closed_at":"2025-12-29T00:40:51.889Z","parent_id":"opencode-next--xts0a-mjqfh0jg26l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfh0jp8el","title":"Diagnose store update propagation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T00:36:23.173Z","updated_at":"2025-12-29T00:40:54.819Z","closed_at":"2025-12-29T00:40:54.819Z","parent_id":"opencode-next--xts0a-mjqfh0jg26l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfh0jsp7s","title":"Diagnose hook re-render timing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T00:36:23.176Z","updated_at":"2025-12-29T00:40:57.898Z","closed_at":"2025-12-29T00:40:57.898Z","parent_id":"opencode-next--xts0a-mjqfh0jg26l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfh0k1ufl","title":"Diagnose component render timing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T00:36:23.185Z","updated_at":"2025-12-29T00:41:00.117Z","closed_at":"2025-12-29T00:41:00.117Z","parent_id":"opencode-next--xts0a-mjqfh0jg26l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfh0k4fip","title":"Document SSE architecture in AGENTS.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T00:36:23.188Z","updated_at":"2025-12-29T00:44:36.142Z","closed_at":"2025-12-29T00:44:36.142Z","parent_id":"opencode-next--xts0a-mjqfh0jg26l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfu2nldml","title":"SSE Performance Optimizations","description":"Implement 4 performance optimizations to fix slow subagent status updates: content-aware React.memo, Zustand shallow selectors, SSE batching, and memoized nested selectors.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T00:46:32.433Z","updated_at":"2025-12-29T00:46:32.433Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfu2o54a9","title":"Content-aware React.memo for Task component","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T00:46:32.453Z","updated_at":"2025-12-29T00:46:32.453Z","parent_id":"opencode-next--xts0a-mjqfu2nldml","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfu2ohiw2","title":"Zustand shallow selectors for parts","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T00:46:32.465Z","updated_at":"2025-12-29T00:46:32.465Z","parent_id":"opencode-next--xts0a-mjqfu2nldml","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfu2ojv23","title":"Batch SSE updates with debounce","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T00:46:32.467Z","updated_at":"2025-12-29T00:46:32.467Z","parent_id":"opencode-next--xts0a-mjqfu2nldml","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfu2om7s8","title":"Memoize nested selectors for summary","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T00:46:32.470Z","updated_at":"2025-12-29T00:46:32.470Z","parent_id":"opencode-next--xts0a-mjqfu2nldml","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfssu5jw6","title":"Viagra Stream: React rendering optimization for SSE streaming","description":"Analyze and optimize React rendering hot paths during AI message streaming. Goal: smooth, sustained message flow without jank or lag.\n\nKnown context from AGENTS.md:\n- Immer creates new object references on every store update\n- useDeferredValue intentionally lags (expected behavior)\n- React.memo with shallow comparison fails due to Immer references\n- Deep nesting for \"currently doing\" data (part.state.metadata.summary)\n\nStrategy: Research-based analysis → targeted file-based fixes","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T00:45:33.053Z","updated_at":"2025-12-29T00:55:36.508Z","closed_at":"2025-12-29T00:55:36.508Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfssucm8u","title":"Profile render counts during streaming with React DevTools","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T00:45:33.060Z","updated_at":"2025-12-29T00:55:26.941Z","closed_at":"2025-12-29T00:55:26.941Z","parent_id":"opencode-next--xts0a-mjqfssu5jw6","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfssufbsi","title":"Audit store selectors for unnecessary re-renders","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T00:45:33.063Z","updated_at":"2025-12-29T00:55:28.237Z","closed_at":"2025-12-29T00:55:28.237Z","parent_id":"opencode-next--xts0a-mjqfssu5jw6","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfssuneuo","title":"Audit component memoization in message rendering chain","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T00:45:33.071Z","updated_at":"2025-12-29T00:55:29.317Z","closed_at":"2025-12-29T00:55:29.317Z","parent_id":"opencode-next--xts0a-mjqfssu5jw6","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqfssuqril","title":"Implement optimizations based on audit findings","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T00:45:33.074Z","updated_at":"2025-12-29T00:55:30.020Z","closed_at":"2025-12-29T00:55:30.020Z","parent_id":"opencode-next--xts0a-mjqfssu5jw6","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqgsexckp0","title":"Add hydration tests for store","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T01:13:14.640Z","updated_at":"2025-12-29T01:26:05.696Z","closed_at":"2025-12-29T01:26:05.696Z","parent_id":"opencode-next--xts0a-mjqgsewok0h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqgsexh2i1","title":"Complete store hydrateMessages implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T01:13:14.645Z","updated_at":"2025-12-29T01:26:07.425Z","closed_at":"2025-12-29T01:26:07.425Z","parent_id":"opencode-next--xts0a-mjqgsewok0h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqgsexpotx","title":"Wire hydration from RSC to client","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T01:13:14.653Z","updated_at":"2025-12-29T01:32:54.678Z","closed_at":"2025-12-29T01:32:54.678Z","parent_id":"opencode-next--xts0a-mjqgsewok0h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqgsexv4r0","title":"Add integration test for hydration flow","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T01:13:14.659Z","updated_at":"2025-12-29T01:36:36.379Z","closed_at":"2025-12-29T01:36:36.379Z","parent_id":"opencode-next--xts0a-mjqgsewok0h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqgsewok0h","title":"Fix message blink with server-side store hydration","description":"Hydrate Zustand store with initial message data from RSC before first render, so tools and text appear simultaneously instead of tools first then text popping in after SSE events arrive","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T01:13:14.616Z","updated_at":"2025-12-29T01:37:12.089Z","closed_at":"2025-12-29T01:37:12.089Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqm12mk78a","title":"Investigate: Session load flashing and delayed message render","description":"Diagnose why session page now:\n1. Takes longer to load\n2. Flashes content multiple times\n3. Messages fill in around task/tool cards (not simultaneously)\n\nDeliverable: Root cause analysis + 2-3 solution recommendations with tradeoffs.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T03:39:56.684Z","updated_at":"2025-12-29T03:41:53.855Z","closed_at":"2025-12-29T03:41:53.855Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqm800xb0e","title":"Immaculate streaming: Content-aware memoization","description":"Eliminate all unnecessary re-renders during streaming by implementing content-aware memoization that works with Immer's copy-on-write semantics. No more flashes, no more lag.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T03:45:19.905Z","updated_at":"2025-12-29T03:45:19.905Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqm801l2ce","title":"Content-aware memoization for individual Message/Tool components","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T03:45:19.929Z","updated_at":"2025-12-29T03:45:19.929Z","parent_id":"opencode-next--xts0a-mjqm800xb0e","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqm8014wxg","title":"Remove hasStoreData toggle, simplify data source","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T03:45:19.912Z","updated_at":"2025-12-29T03:49:05.273Z","closed_at":"2025-12-29T03:49:05.273Z","parent_id":"opencode-next--xts0a-mjqm800xb0e","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqm80182cn","title":"Hydrate store before first render (not useEffect)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T03:45:19.916Z","updated_at":"2025-12-29T03:52:34.554Z","closed_at":"2025-12-29T03:52:34.554Z","parent_id":"opencode-next--xts0a-mjqm800xb0e","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqm801ic6m","title":"Content-aware memoization for MessageList","status":"blocked","priority":1,"issue_type":"task","created_at":"2025-12-29T03:45:19.926Z","updated_at":"2025-12-29T03:53:47.910Z","parent_id":"opencode-next--xts0a-mjqm800xb0e","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmlmg5ki7","title":"ADR: Effect-TS Migration Strategy","description":"Research and document an Architecture Decision Record for migrating opencode-next to Effect-TS.\n\n## Context\n- Currently using vanilla async/await with manual error handling\n- SSE reconnection, server discovery, and store updates have complex error/retry logic\n- Effect would provide: structured concurrency, typed errors, resource management, observability\n\n## Research Needed\n1. **Inventory current patterns** - Map all async operations, error handling, retries, timeouts\n2. **Effect fit analysis** - Which patterns benefit most from Effect?\n3. **Migration strategy** - Big bang vs incremental? Which layer first?\n4. **Bundle size impact** - Effect adds ~50kb gzipped, acceptable for this app?\n5. **Team familiarity** - Learning curve considerations\n6. **Interop patterns** - How to bridge Effect with React hooks, Next.js, Zustand?\n\n## Deliverable\nADR document at `docs/adr/002-effect-migration.md` with:\n- Decision (adopt/reject/defer)\n- Context and problem statement\n- Options considered\n- Consequences (positive/negative)\n- Migration plan if adopting\n\n## Trigger\nJoel asked about using Effect in the opencode-servers route. Rather than ad-hoc adoption, need a coherent strategy.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T03:55:55.493Z","updated_at":"2025-12-29T03:55:55.493Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmsbfn77x","title":"Session polish: commit, hydration, tool tree","description":"Three-part session work: 1) Commit uncommitted changes, 2) Complete store hydration to fix message blink, 3) Add full tool tree display for subagents","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:01:07.811Z","updated_at":"2025-12-29T04:01:07.811Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmsbfujhk","title":"Review and commit uncommitted changes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:01:07.818Z","updated_at":"2025-12-29T04:02:49.691Z","closed_at":"2025-12-29T04:02:49.691Z","parent_id":"opencode-next--xts0a-mjqmsbfn77x","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqcwzq3wdr","title":"Session summary: Message queue, scroll bounce fix, surfer loader","description":"## Good Changes Made This Session\n\n### 1. Message Queue in useSendMessage ✅\n**File:** `apps/web/src/react/use-send-message.ts`\n- Added client-side FIFO queue for messages\n- Can queue messages while session is busy\n- Exposes `queueLength` for UI feedback\n- Continues processing even if one message fails\n- Tests added and passing\n\n### 2. Scroll Bounce Fix ✅\n**File:** `apps/web/src/components/ai-elements/conversation.tsx`\n- Added `scrollToBottomInstant()` for auto-scroll (no animation)\n- `scrollToBottom()` kept smooth for manual button clicks\n- ResizeObserver now uses instant scroll\n- Initial page load uses instant scroll\n- Prevents overlapping smooth scrolls that caused bounce\n\n### 3. Surfer Loader ✅\n**Files:** \n- `apps/web/src/components/ai-elements/loader.tsx` - Replaced spinner with 🏄‍♂️\n- `apps/web/src/app/globals.css` - Added `animate-surf` keyframes\n\n### 4. Store Hydration ✅ COMPLETE\n**Files:**\n- `apps/web/src/react/store.ts` - Added `hydrateMessages()` method (idempotent, binary search insertion)\n- `apps/web/src/app/session/[id]/session-messages.tsx` - Synchronous hydration before first render\n- `apps/web/src/app/session/[id]/page.tsx` - Passes raw OpenCodeMessages\n\n**Implementation:**\n- Synchronous hydration during render (before hooks)\n- Idempotent check prevents double-hydration\n- All 12 integration tests pass\n- Verified by Worker 2 (WarmStone) - no flash, messages appear immediately\n\n## Cells Created\n- `opencode-next--xts0a-mjqbm7xyzse` - Future improvement: use prompt_async + SSE\n- `opencode-next--xts0a-mjqcwkjhpn1` - ROLLBACK needed for layout changes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T23:24:49.755Z","updated_at":"2025-12-29T04:14:11.159Z","closed_at":"2025-12-29T04:14:11.159Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqdyseewoi","title":"Subagent display: full tool tree (TUI-style)","description":"Enhancement: Show full tree of tools executed by subagent, like TUI does.\n\n```\n◉ Swarm-Worker Task \"Worker: Visual queue feedback UI\"\n├ Swarmmail_init ✓\n├ Semantic-Memory_find ✓\n├ Swarmmail_reserve ✓\n├ Read apps/web/src/session-layout.tsx ✓\n├ Edit apps/web/src/session-layout.tsx ✓\n└ Bash Run typecheck ⏳\n```\n\nDepends on MVP \"currently doing\" title being done first.\n\nImplementation:\n- Render full metadata.summary array as tree\n- Status icons: ✓ completed, ⏳ running, ✗ error\n- Collapsible (default collapsed, expand on click)\n- Consider virtualization for long lists\n\nReference: docs/guides/SUBAGENT_DISPLAY.md Section 5","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-28T23:54:13.190Z","updated_at":"2025-12-29T04:14:12.432Z","closed_at":"2025-12-29T04:14:12.432Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmsbfx7ew","title":"Complete store hydration to fix message blink","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:01:07.821Z","updated_at":"2025-12-29T04:14:08.215Z","closed_at":"2025-12-29T04:14:08.215Z","parent_id":"opencode-next--xts0a-mjqmsbfn77x","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmsbg0gkd","title":"Add full tool tree display for subagents","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:01:07.824Z","updated_at":"2025-12-29T04:14:09.448Z","closed_at":"2025-12-29T04:14:09.448Z","parent_id":"opencode-next--xts0a-mjqmsbfn77x","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwnanai","title":"Research: Inventory current async patterns in opencode-next","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:03:08.614Z","updated_at":"2025-12-29T04:10:30.216Z","closed_at":"2025-12-29T04:10:30.216Z","parent_id":"opencode-next--xts0a-mjqmuwn2vqq","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwne34c","title":"Research: Effect-TS ecosystem and core concepts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:03:08.618Z","updated_at":"2025-12-29T04:10:32.730Z","closed_at":"2025-12-29T04:10:32.730Z","parent_id":"opencode-next--xts0a-mjqmuwn2vqq","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwnmlbg","title":"Research: Effect + React/Next.js/Zustand interop patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:03:08.626Z","updated_at":"2025-12-29T04:10:35.633Z","closed_at":"2025-12-29T04:10:35.633Z","parent_id":"opencode-next--xts0a-mjqmuwn2vqq","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwnp4v1","title":"Research: Bundle size and performance implications","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:03:08.629Z","updated_at":"2025-12-29T04:10:38.334Z","closed_at":"2025-12-29T04:10:38.334Z","parent_id":"opencode-next--xts0a-mjqmuwn2vqq","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwnseak","title":"Research: Real-world Effect adoption case studies","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:03:08.632Z","updated_at":"2025-12-29T04:10:40.667Z","closed_at":"2025-12-29T04:10:40.667Z","parent_id":"opencode-next--xts0a-mjqmuwn2vqq","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwn2vqq","title":"ADR: Effect-TS Migration Strategy","description":"Research and document an Architecture Decision Record for migrating opencode-next to Effect-TS. Holistic analysis covering: current patterns inventory, Effect ecosystem research, bundle size analysis, React/Next.js/Zustand interop patterns, and final ADR synthesis.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:03:08.606Z","updated_at":"2025-12-29T04:17:30.447Z","closed_at":"2025-12-29T04:17:30.447Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqmuwnvwrl","title":"Synthesis: Write ADR 002 Effect Migration document","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:03:08.635Z","updated_at":"2025-12-29T04:17:27.148Z","closed_at":"2025-12-29T04:17:27.148Z","parent_id":"opencode-next--xts0a-mjqmuwn2vqq","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnde5s57u","title":"Performance audit: scan for anti-patterns","description":"Scan codebase for React performance anti-patterns that could cause hangs, excessive re-renders, or memory leaks. Known patterns to check: JSON.stringify in memo comparators, inline object creation in render, missing useCallback/useMemo, Zustand selector issues, useEffect dependency arrays.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:17:31.120Z","updated_at":"2025-12-29T04:17:31.120Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnde5ypmn","title":"Scan core components for perf anti-patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:17:31.126Z","updated_at":"2025-12-29T04:22:57.954Z","closed_at":"2025-12-29T04:22:57.954Z","parent_id":"opencode-next--xts0a-mjqnde5s57u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnde61yj6","title":"Scan hooks and store for perf anti-patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:17:31.129Z","updated_at":"2025-12-29T04:22:59.364Z","closed_at":"2025-12-29T04:22:59.364Z","parent_id":"opencode-next--xts0a-mjqnde5s57u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnde63abc","title":"Scan session pages for perf anti-patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:17:31.131Z","updated_at":"2025-12-29T04:23:00.658Z","closed_at":"2025-12-29T04:23:00.658Z","parent_id":"opencode-next--xts0a-mjqnde5s57u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2kk88p","title":"Fix HIGH priority perf anti-patterns","description":"Fix 13 HIGH priority React performance anti-patterns identified in audit. Issues include: unstable useEffect deps, missing React.memo, inline object creation, redundant subscriptions.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:24:16.004Z","updated_at":"2025-12-29T04:24:16.004Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2ksno2","title":"Fix message.tsx perf issues (childrenArray, Proxy)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:24:16.012Z","updated_at":"2025-12-29T04:31:57.003Z","closed_at":"2025-12-29T04:31:57.003Z","parent_id":"opencode-next--xts0a-mjqnm2kk88p","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2kwc2j","title":"Fix conversation.tsx ResizeObserver recreation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:24:16.016Z","updated_at":"2025-12-29T04:31:57.700Z","closed_at":"2025-12-29T04:31:57.700Z","parent_id":"opencode-next--xts0a-mjqnm2kk88p","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2kzkly","title":"Fix session-messages.tsx HOT PATH (memo, filter, regex)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T04:24:16.019Z","updated_at":"2025-12-29T04:31:58.642Z","closed_at":"2025-12-29T04:31:58.642Z","parent_id":"opencode-next--xts0a-mjqnm2kk88p","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2l8m2u","title":"Fix projects-list.tsx (SessionRow memo, selectors, bootstrap)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:24:16.028Z","updated_at":"2025-12-29T04:31:59.734Z","closed_at":"2025-12-29T04:31:59.734Z","parent_id":"opencode-next--xts0a-mjqnm2kk88p","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2lbjgj","title":"Fix session-layout.tsx (extract DebugPanel, interval)","description":"Blocked: SwiftStar has reservation on session-layout.tsx. Waiting for coordination.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T04:24:16.031Z","updated_at":"2025-12-29T04:32:00.387Z","closed_at":"2025-12-29T04:32:00.387Z","parent_id":"opencode-next--xts0a-mjqnm2kk88p","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnm2lexv4","title":"Fix session-status.tsx redundant SSE subscriptions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:24:16.034Z","updated_at":"2025-12-29T04:32:01.300Z","closed_at":"2025-12-29T04:32:01.300Z","parent_id":"opencode-next--xts0a-mjqnm2kk88p","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqnyjy4hec","title":"Fix 4 failing SessionStatus integration tests","description":"4 tests in session-status.test.tsx are failing:\n1. shows loading state initially\n2. shows Running when session is running\n3. shows error message when session.error event fires\n4. error state clears when session starts running again\n\nRoot cause: Tests simulate SSE events via store.handleSSEEvent() but the component isn't re-rendering with updated state. Likely a test setup issue with how the store mock interacts with React's render cycle.\n\nFiles:\n- apps/web/src/app/session/[id]/session-status.test.tsx","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-29T04:33:58.396Z","updated_at":"2025-12-29T04:33:58.396Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gqfm25","title":"Message windowing hook + scroll detection","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:40:07.479Z","updated_at":"2025-12-29T04:49:30.100Z","closed_at":"2025-12-29T04:49:30.100Z","parent_id":"opencode-next--xts0a-mjqo6gq7jzy","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gql7td","title":"Lightweight message placeholder component","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:40:07.485Z","updated_at":"2025-12-29T04:49:32.358Z","closed_at":"2025-12-29T04:49:32.358Z","parent_id":"opencode-next--xts0a-mjqo6gq7jzy","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gqujtb","title":"Memoize Message component with content-aware comparison","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:40:07.494Z","updated_at":"2025-12-29T04:49:34.850Z","closed_at":"2025-12-29T04:49:34.850Z","parent_id":"opencode-next--xts0a-mjqo6gq7jzy","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gr1gdr","title":"Verify SSE batching is applied to store updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:40:07.501Z","updated_at":"2025-12-29T04:49:36.662Z","closed_at":"2025-12-29T04:49:36.662Z","parent_id":"opencode-next--xts0a-mjqo6gq7jzy","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm5q56r","title":"Scaffold packages/router with Effect dependency","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-29T04:50:21.038Z","updated_at":"2025-12-29T04:50:21.038Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm5szvj","title":"TDD: Types and Errors (test + implement)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:50:21.040Z","updated_at":"2025-12-29T04:50:21.040Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm5v8a2","title":"TDD: Schedule builder (test + implement)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:50:21.043Z","updated_at":"2025-12-29T04:50:21.043Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm5yx68","title":"TDD: Route builder API (test + implement)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:50:21.046Z","updated_at":"2025-12-29T04:50:21.046Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm61tbm","title":"TDD: Request executor (test + implement)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:50:21.049Z","updated_at":"2025-12-29T04:50:21.049Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm63zmm","title":"TDD: Stream executor with heartbeat (test + implement)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:50:21.051Z","updated_at":"2025-12-29T04:50:21.051Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm65vnm","title":"TDD: Router and route resolution (test + implement)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:50:21.053Z","updated_at":"2025-12-29T04:50:21.053Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm67rt0","title":"TDD: Next.js adapter (test + implement)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T04:50:21.055Z","updated_at":"2025-12-29T04:50:21.055Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm6bohm","title":"TDD: Direct caller adapter (test + implement)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T04:50:21.059Z","updated_at":"2025-12-29T04:50:21.059Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm6ddh6","title":"Integration test: Full router with mock SDK","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T04:50:21.061Z","updated_at":"2025-12-29T04:50:21.061Z","parent_id":"opencode-next--xts0a-mjqojm5dpgo","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqojm5dpgo","title":"Build @opencode/router package (TDD)","description":"Build the Effect-powered router package per ADR 002. TDD approach: write tests first, then implement.\n\nPackage structure:\n- packages/router/src/builder.ts - createOpencodeRoute() fluent API\n- packages/router/src/types.ts - RouteConfig, Route, HandlerContext types\n- packages/router/src/errors.ts - Typed error classes\n- packages/router/src/schedule.ts - Retry schedule builders\n- packages/router/src/executor.ts - Effect execution engine\n- packages/router/src/stream.ts - Streaming + heartbeat support\n- packages/router/src/router.ts - createRouter(), route resolution\n- packages/router/src/adapters/next.ts - Next.js integration\n- packages/router/src/adapters/direct.ts - createCaller()\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree\nBranch: feature/effect-router","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:50:21.025Z","updated_at":"2025-12-29T04:52:01.562Z","closed_at":"2025-12-29T04:52:01.562Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9t1h6o","title":"Add effect dependency + scaffold router directory","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-29T04:53:58.309Z","updated_at":"2025-12-29T04:53:58.309Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9t7hzm","title":"TDD: Types (Duration, RouteConfig, Route, HandlerContext)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:53:58.315Z","updated_at":"2025-12-29T04:53:58.315Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9tk1cr","title":"TDD: Typed errors (RouteError, TimeoutError, StreamError, etc)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:53:58.328Z","updated_at":"2025-12-29T04:53:58.328Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9tnblu","title":"TDD: Schedule builder (exponential, linear, custom retry)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:53:58.331Z","updated_at":"2025-12-29T04:53:58.331Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9trebh","title":"TDD: Route builder API (fluent .input().middleware().handler())","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T04:53:58.335Z","updated_at":"2025-12-29T04:53:58.335Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9ttk1t","title":"TDD: Request executor (timeout, retry, validation)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T04:53:58.337Z","updated_at":"2025-12-29T04:53:58.337Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9tw9w3","title":"TDD: Stream executor (heartbeat, retry, abort signal)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T04:53:58.340Z","updated_at":"2025-12-29T04:53:58.340Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9ty3da","title":"TDD: Router + route resolution (createRouter, nested routes)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T04:53:58.342Z","updated_at":"2025-12-29T04:53:58.342Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gq7jzy","title":"Performance: Hybrid windowing + streaming optimization","description":"Fix Chrome freezing on long sessions. Implement hybrid windowing (last 50 messages full, older virtualized) and optimize streaming (memoization, batching, reduce re-renders).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:40:07.471Z","updated_at":"2025-12-29T05:03:16.249Z","closed_at":"2025-12-29T05:03:16.249Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gqx44q","title":"Memoize Tool/Task components with content-aware comparison","description":"UNBLOCKED: Use id+status comparison only (no JSON.stringify). The semantic memory warning about browser hangs is correct - avoid stringifying large tool outputs. Compare: part.id, part.state?.status only. For Task: also compare part.state?.metadata?.summary.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:40:07.497Z","updated_at":"2025-12-29T04:54:12.804Z","closed_at":"2025-12-29T04:54:12.804Z","parent_id":"opencode-next--xts0a-mjqo6gq7jzy","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqo6gqz5im","title":"Integrate windowing into Conversation component","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T04:40:07.499Z","updated_at":"2025-12-29T05:03:08.422Z","closed_at":"2025-12-29T05:03:08.422Z","parent_id":"opencode-next--xts0a-mjqo6gq7jzy","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9sqqfb","title":"Build @/core/router - Effect-powered async router (TDD)","description":"Build the Effect-powered router per ADR 002. TDD approach: RED → GREEN → REFACTOR.\n\nRELATED: Epic mjqo6gq7jzy (Performance: Hybrid windowing + streaming optimization)\n- Stream executor should incorporate SSE batching patterns\n- useSubscription hook replaces current SSE handling with Effect.Stream\n- Content-aware memoization learnings apply to streaming components\n\nDirectory: apps/web/src/core/router/\n- builder.ts - createOpencodeRoute() fluent API\n- types.ts - RouteConfig, Route, HandlerContext types  \n- errors.ts - Typed error classes (Data.TaggedError)\n- schedule.ts - Retry schedule builders\n- executor.ts - Effect execution engine (request-response)\n- stream.ts - Streaming + heartbeat support\n- router.ts - createRouter(), route resolution\n- adapters/next.ts - createNextHandler(), createAction()\n- adapters/direct.ts - createCaller()\n- index.ts - Public exports\n\nReact hooks (apps/web/src/react/):\n- use-subscription.ts - Streaming hook with visibility API + batching\n- use-query.ts - Request-response hook\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree\nBranch: feature/effect-router","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T04:53:58.298Z","updated_at":"2025-12-29T04:57:39.740Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqox769brm","title":"TDD: types.ts - RouteConfig, Route, HandlerContext types","description":"File: apps/web/src/core/router/types.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write types.test.ts\n```typescript\n// Type-level tests using expectTypeOf or ts-expect-error\n// Test Duration accepts \"5s\", \"100ms\", \"2m\", \"1h\"\n// Test Duration rejects \"5x\", \"abc\", 5\n// Test RouteConfig accepts valid configs\n// Test Route generic parameters flow correctly\n```\n\n### Step 2: Implement types.ts to make tests pass\n\nDefine all TypeScript types per ADR 002:\n- Duration type (`${number}${\"ms\" | \"s\" | \"m\" | \"h\"}`)\n- RetryConfig (none | exponential | linear | custom object)\n- RouteConfig (timeout, retry, concurrency, stream, heartbeat, cache)\n- Route<TInput, TOutput> with _config, _inputSchema, _middleware, _handler, _errorHandler\n- HandlerContext<TInput, TCtx> with input, sdk, signal, ctx\n- HandlerFn (Promise or AsyncGenerator)\n- RouteBuilder interface (fluent API types)\n- OpencodeClient type (from SDK)\n- RouterEnv (Effect Context tag)\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:00:54.801Z","updated_at":"2025-12-29T05:07:47.915Z","closed_at":"2025-12-29T05:07:47.915Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoxar26b9","title":"TDD: errors.ts - Typed error classes (Data.TaggedError)","description":"File: apps/web/src/core/router/errors.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write errors.test.ts\n```typescript\ndescribe(\"RouteError\", () => {\n  it(\"has _tag 'RouteError'\", () => {\n    const err = new RouteError({ cause: \"test\" })\n    expect(err._tag).toBe(\"RouteError\")\n  })\n})\n// Repeat for ValidationError, TimeoutError, HandlerError, StreamError, HeartbeatTimeoutError, MiddlewareError\n```\n\n### Step 2: Implement errors.ts to make tests pass\n\nDefine typed errors per ADR 002 using Effect Data.TaggedError:\n- RouteError (base, route + cause)\n- ValidationError (route + ZodIssue[])\n- TimeoutError (route + duration)\n- HandlerError (route + cause)\n- StreamError (route + cause)\n- HeartbeatTimeoutError (route + duration)\n- MiddlewareError (route + cause)\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:00:59.438Z","updated_at":"2025-12-29T05:07:49.517Z","closed_at":"2025-12-29T05:07:49.517Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9u863g","title":"Integration test: Full router with mock SDK","description":"File: apps/web/src/core/router/integration.test.ts\n\n## Integration test with mock SDK\n\n### Tests:\n- Full router with all route types\n- Request-response routes work end-to-end\n- Streaming routes work end-to-end\n- Timeout behavior\n- Retry behavior\n- Error handling\n\nUses mock SDK to test without real backend.\n\nDepends on: All router files\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T04:53:58.352Z","updated_at":"2025-12-29T05:21:48.134Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoxf5l82g","title":"TDD: schedule.ts - Retry schedule builders","description":"File: apps/web/src/core/router/schedule.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write schedule.test.ts\n```typescript\ndescribe(\"parseDuration\", () => {\n  it(\"parses '5s' to 5000ms\", () => {...})\n  it(\"parses '100ms' to 100ms\", () => {...})\n  it(\"parses '2m' to 120000ms\", () => {...})\n})\n\ndescribe(\"buildSchedule\", () => {\n  it(\"'none' returns Schedule that never retries\", () => {...})\n  it(\"'exponential' retries with 1s, 2s, 4s delays\", () => {...})\n  it(\"'linear' retries with 1s, 2s, 3s delays\", () => {...})\n  it(\"custom config respects maxRetries\", () => {...})\n})\n```\n\n### Step 2: Implement schedule.ts to make tests pass\n\nDepends on: types.ts\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:01:05.145Z","updated_at":"2025-12-29T05:13:20.834Z","closed_at":"2025-12-29T05:13:20.834Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoxjibkp1","title":"TDD: executor.ts - Effect execution engine (request-response)","description":"File: apps/web/src/core/router/executor.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write executor.test.ts\n```typescript\ndescribe(\"executeRoute\", () => {\n  it(\"validates input against schema\", async () => {...})\n  it(\"throws ValidationError for invalid input\", async () => {...})\n  it(\"runs middleware chain in order\", async () => {...})\n  it(\"passes context through middleware\", async () => {...})\n})\n\ndescribe(\"executeRequestHandler\", () => {\n  it(\"executes handler and returns result\", async () => {...})\n  it(\"throws TimeoutError after configured duration\", async () => {...})\n  it(\"retries on failure per retry config\", async () => {...})\n  it(\"wraps handler errors in HandlerError\", async () => {...})\n})\n```\n\n### Step 2: Implement executor.ts to make tests pass\n\nDepends on: types.ts, errors.ts, schedule.ts\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:01:10.787Z","updated_at":"2025-12-29T05:21:10.810Z","closed_at":"2025-12-29T05:21:10.810Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoxo6y7cr","title":"TDD: stream.ts - Streaming + heartbeat support","description":"File: apps/web/src/core/router/stream.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write stream.test.ts\n```typescript\ndescribe(\"executeStreamHandler\", () => {\n  it(\"yields events from async generator\", async () => {...})\n  it(\"throws HeartbeatTimeoutError when no events in heartbeat duration\", async () => {...})\n  it(\"retries on connection error\", async () => {...})\n  it(\"stops when abort signal fires\", async () => {...})\n})\n\ndescribe(\"streamToReadable\", () => {\n  it(\"converts Effect.Stream to ReadableStream\", async () => {...})\n})\n\ndescribe(\"streamToAsyncIterable\", () => {\n  it(\"converts Effect.Stream to AsyncIterable\", async () => {...})\n})\n```\n\n### Step 2: Implement stream.ts to make tests pass\n\nDepends on: types.ts, errors.ts, schedule.ts\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:01:16.858Z","updated_at":"2025-12-29T05:21:11.882Z","closed_at":"2025-12-29T05:21:11.882Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoxs4xmfw","title":"TDD: builder.ts - createOpencodeRoute() fluent API","description":"File: apps/web/src/core/router/builder.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write builder.test.ts\n```typescript\ndescribe(\"createOpencodeRoute\", () => {\n  it(\"returns a function that creates route builders\", () => {...})\n  \n  describe(\"RouteBuilder\", () => {\n    it(\".input() stores schema on route\", () => {...})\n    it(\".middleware() chains multiple middleware\", () => {...})\n    it(\".handler() returns Route with all config\", () => {...})\n    it(\".onError() sets error handler\", () => {...})\n    it(\"config is passed through to Route._config\", () => {...})\n  })\n})\n```\n\n### Step 2: Implement builder.ts to make tests pass\n\nDepends on: types.ts\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:01:21.969Z","updated_at":"2025-12-29T05:13:22.544Z","closed_at":"2025-12-29T05:13:22.544Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoxwe2zn3","title":"TDD: router.ts - createRouter() and route resolution","description":"File: apps/web/src/core/router/router.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write router.test.ts\n```typescript\ndescribe(\"createRouter\", () => {\n  it(\"creates router from nested route object\", () => {...})\n  \n  describe(\"Router.resolve\", () => {\n    it(\"resolves 'session.get' to correct route\", () => {...})\n    it(\"resolves deeply nested 'subscribe.events' to correct route\", () => {...})\n    it(\"throws RouteNotFoundError for invalid path\", () => {...})\n  })\n  \n  // Type-level tests\n  it(\"infers route paths correctly (compile-time)\", () => {...})\n})\n```\n\n### Step 2: Implement router.ts to make tests pass\n\nDepends on: types.ts, builder.ts\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T05:01:27.482Z","updated_at":"2025-12-29T05:21:12.841Z","closed_at":"2025-12-29T05:21:12.841Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9u0may","title":"TDD: Next.js adapter (createNextHandler, createAction)","description":"File: apps/web/src/core/router/adapters/next.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write adapters/next.test.ts\n- createNextHandler() creates API route handler\n- Handles streaming routes with SSE response\n- Handles request-response routes with JSON\n- Aborts on client disconnect\n\n### Step 2: Implement adapters/next.ts\n- createNextHandler(router, opts) - API route handler\n- createAction(route) - Server Action wrapper\n\nDepends on: router.ts, executor.ts, stream.ts\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T04:53:58.344Z","updated_at":"2025-12-29T05:32:41.892Z","closed_at":"2025-12-29T05:32:41.892Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9u3pmw","title":"TDD: Direct caller adapter (createCaller for RSC)","description":"File: apps/web/src/core/router/adapters/direct.ts\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write adapters/direct.test.ts\n- createCaller() creates direct caller for RSC\n- Caller executes routes without HTTP\n- Handles streaming routes\n\n### Step 2: Implement adapters/direct.ts\n- createCaller(router, ctx) - Direct caller for RSC\n\nDepends on: router.ts, executor.ts, stream.ts\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T04:53:58.347Z","updated_at":"2025-12-29T05:34:20.724Z","closed_at":"2025-12-29T05:34:20.724Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqoo9u5xx5","title":"TDD: useSubscription hook (streaming + visibility API)","description":"File: apps/web/src/react/use-subscription.ts (NEW - router-react package)\n\n## TDD ORDER: TESTS FIRST\n\n### Step 1: Write use-subscription.test.ts\n- useSubscription() subscribes to streaming route\n- Pauses on visibility hidden\n- Resumes on visibility visible\n- Batches events (16ms debounce)\n- Handles reconnection\n\n### Step 2: Implement use-subscription.ts per ADR 002\n\nDepends on: stream.ts patterns\n\nWorktree: /Users/joel/Code/joelhooks/opencode-router-worktree","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T04:53:58.349Z","updated_at":"2025-12-29T05:40:04.109Z","closed_at":"2025-12-29T05:40:04.109Z","parent_id":"opencode-next--xts0a-mjqoo9sqqfb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqqsq48ot0","title":"Add pagination + virtual scrolling for messages","description":"Current state:\n- Initial load uses limit=20 ✅\n- No \"load more\" when scrolling up ❌\n- No virtual scrolling ❌\n\nImplementation:\n1. Add loadMore function to store that fetches older messages\n2. Detect scroll-to-top in Conversation component\n3. Add @tanstack/react-virtual for virtualization\n4. Show loading indicator when fetching older messages\n\nAPI: GET /session/:sessionID/message?limit=N returns newest N messages","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-29T05:53:25.304Z","updated_at":"2025-12-29T05:53:25.304Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqqtkhpfsz","title":"Add pagination + virtual scrolling for messages","description":"Implement virtual scrolling for message list to handle large conversations efficiently.\n\nGoals:\n- Only render visible messages (+ buffer)\n- Maintain scroll position during updates\n- Support scroll-to-bottom behavior\n- Handle dynamic message heights\n\nWorktree isolation for safe experimentation.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T05:54:04.669Z","updated_at":"2025-12-29T06:12:37.413Z","closed_at":"2025-12-29T06:12:37.413Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqrw3zcdf9","title":"Compaction UX: Context usage bar + compaction indicator","description":"Improve compaction UX by showing context usage percentage and visual feedback during compaction instead of frozen UI","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T06:24:02.856Z","updated_at":"2025-12-29T06:40:19.634Z","closed_at":"2025-12-29T06:40:19.634Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqrw3zklgn","title":"Extend store with context/compaction state and SSE handlers","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T06:24:02.864Z","updated_at":"2025-12-29T06:32:08.102Z","closed_at":"2025-12-29T06:32:08.102Z","parent_id":"opencode-next--xts0a-mjqrw3zcdf9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqrw3zo1xy","title":"Create useContextUsage hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T06:24:02.868Z","updated_at":"2025-12-29T06:35:55.413Z","closed_at":"2025-12-29T06:35:55.413Z","parent_id":"opencode-next--xts0a-mjqrw3zcdf9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqrw3zt06v","title":"Create useCompactionState hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T06:24:02.873Z","updated_at":"2025-12-29T06:35:56.453Z","closed_at":"2025-12-29T06:35:56.453Z","parent_id":"opencode-next--xts0a-mjqrw3zcdf9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqrw3zwmww","title":"Create ContextUsageBar and CompactionIndicator components + integrate","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T06:24:02.876Z","updated_at":"2025-12-29T06:40:17.804Z","closed_at":"2025-12-29T06:40:17.804Z","parent_id":"opencode-next--xts0a-mjqrw3zcdf9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqty24ae6z","title":"Create ROUTER_MIGRATION.md guide for Effect router integration","description":"Create a detailed migration guide at docs/guides/ROUTER_MIGRATION.md that serves as an actionable playbook for AI agents to migrate from current async patterns to the new Effect-powered router.\n\nThe guide should:\n1. Be written FOR AGENTS (step-by-step, no debate, just execution)\n2. Reference ADR 002 for design context\n3. Cover each migration target with before/after examples\n4. Include verification steps (tests, type checks)\n5. Document gotchas and edge cases\n\nMigration targets (from ADR 002):\n- api/opencode-servers/route.ts (150+ lines → 15)\n- use-sse.tsx (342 lines → 30)\n- multi-server-sse.ts (454 lines → 50)\n- use-send-message.ts (208 lines → 40)\n- use-create-session.ts (116 lines → 10)\n- use-file-search.ts (115 lines → 15)\n- use-providers.ts (94 lines → 10)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T07:21:32.986Z","updated_at":"2025-12-29T07:22:20.443Z","closed_at":"2025-12-29T07:22:20.443Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqtzbbnuwv","title":"ROUTER_MIGRATION.md - Effect Router Integration Guide","description":"Create a detailed migration guide for AI agents to migrate from current async patterns to the Effect-powered router.\n\nPhase 1: Research current implementations (understand what exists)\nPhase 2: Research new router capabilities (understand what we're migrating TO)\nPhase 3: Write the migration guide with concrete before/after examples\n\nReference: docs/adr/002-effect-migration.md for design context","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T07:22:31.571Z","updated_at":"2025-12-29T07:22:31.571Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqtzbbsgsd","title":"Research: Analyze current async implementations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T07:22:31.576Z","updated_at":"2025-12-29T07:22:31.576Z","parent_id":"opencode-next--xts0a-mjqtzbbnuwv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqtzbbxnjk","title":"Research: Analyze new Effect router implementation","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T07:22:31.581Z","updated_at":"2025-12-29T07:22:31.581Z","parent_id":"opencode-next--xts0a-mjqtzbbnuwv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqtzbc6wdx","title":"Write: ROUTER_MIGRATION.md guide","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T07:22:31.590Z","updated_at":"2025-12-29T07:22:31.590Z","parent_id":"opencode-next--xts0a-mjqtzbbnuwv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjqu9op6uu7","title":"Task cards stuck on 'starting' - subagent status not updating","description":"When Task tool spawns subagents, the task card UI shows \"starting\" status and never updates to show the subagent's current work item or progress.\n\n## Expected Behavior\nTask cards should show:\n- Current task the subagent is working on\n- Progress updates as subagent completes steps\n- Final result when subagent completes\n\n## Actual Behavior\nTask cards stay on \"starting\" until the entire subagent completes, then show final result.\n\n## Root Cause Investigation Needed\n- Check if SSE events for subagent progress are being emitted\n- Check if task.tsx component subscribes to subagent status updates\n- Check if store handles subagent progress events\n\n## Related Files\n- apps/web/src/components/ai-elements/task.tsx\n- apps/web/src/react/store.ts (subagent event handling)\n- docs/audits/04-SUBAGENT-DISPLAY-AUDIT.md","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-29T07:30:35.466Z","updated_at":"2025-12-29T07:30:35.466Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn0j0kp","title":"Define all SDK routes in routes.ts","description":"## Define all SDK routes in routes.ts\n\n**File:** `apps/web/src/core/router/routes.ts`\n\n### Current State\n- Line 60-68: Only `messages.list` route exists\n- Line 36-71: `createRoutes()` factory returns nested route object\n\n### Routes to Add (from SDK namespaces)\n\n**Session namespace:**\n```typescript\n\"session.get\": o({ timeout: \"30s\" })\n  .input(Schema.Struct({ id: Schema.String }))\n  .handler(async ({ input, sdk }) => sdk.session.get({ path: { id: input.id } }))\n\n\"session.list\": o({ timeout: \"10s\" })\n  .handler(async ({ sdk }) => sdk.session.list())\n\n\"session.create\": o({ timeout: \"10s\" })\n  .input(Schema.Struct({ title: Schema.optional(Schema.String) }))\n  .handler(async ({ input, sdk }) => sdk.session.create({ body: input }))\n\n\"session.promptAsync\": o({ timeout: \"5m\" })\n  .input(Schema.Struct({ \n    id: Schema.String, \n    parts: Schema.Array(Schema.Unknown),\n    model: Schema.optional(Schema.String)\n  }))\n  .handler(async ({ input, sdk }) => sdk.session.promptAsync({ \n    path: { id: input.id }, \n    body: { parts: input.parts, model: input.model } \n  }))\n\n\"session.messages\": o({ timeout: \"30s\" })\n  .input(Schema.Struct({ id: Schema.String, limit: Schema.optional(Schema.Number) }))\n  .handler(async ({ input, sdk }) => sdk.session.messages({ \n    path: { id: input.id }, \n    query: { limit: input.limit } \n  }))\n\n\"session.status\": o({ timeout: \"5s\" })\n  .input(Schema.Struct({ id: Schema.String }))\n  .handler(async ({ input, sdk }) => sdk.session.status({ path: { id: input.id } }))\n\n\"session.todo\": o({ timeout: \"10s\" })\n  .input(Schema.Struct({ id: Schema.String }))\n  .handler(async ({ input, sdk }) => sdk.session.todo({ path: { id: input.id } }))\n\n\"session.diff\": o({ timeout: \"10s\" })\n  .input(Schema.Struct({ id: Schema.String }))\n  .handler(async ({ input, sdk }) => sdk.session.diff({ path: { id: input.id } }))\n```\n\n**Provider namespace:**\n```typescript\n\"provider.list\": o({ timeout: \"10s\" })\n  .handler(async ({ sdk }) => sdk.provider.list())\n```\n\n**Project namespace:**\n```typescript\n\"project.list\": o({ timeout: \"10s\" })\n  .handler(async ({ sdk }) => sdk.project.list())\n```\n\n**Global namespace (streaming):**\n```typescript\n\"global.event\": o({ stream: true, heartbeat: \"60s\" })\n  .handler(async function* ({ sdk }) {\n    const events = await sdk.global.event()\n    for await (const event of events.stream) {\n      yield event\n    }\n  })\n```\n\n### Implementation Notes\n- Use Effect Schema (not Zod) - already imported at line 3\n- Follow existing pattern at line 60-68\n- Timeout values based on operation type (quick reads: 10s, AI ops: 5m)\n- Streaming routes use `async function*` generator pattern\n\n### Tests\n- Add route definition tests in `routes.test.ts`\n- Verify schema validation works\n- Verify timeout config is applied\n\n### Acceptance Criteria\n- [ ] All 12+ routes defined with proper schemas\n- [ ] Timeout/retry config appropriate per route\n- [ ] Streaming routes use generator pattern\n- [ ] Tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T16:30:59.203Z","updated_at":"2025-12-29T16:31:23.801Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn0ngzq","title":"Export public API from router/index.ts","description":"## Export public API from router/index.ts\n\n**File:** `apps/web/src/core/router/index.ts`\n\n### Current State\n- Line 8: Empty file with no exports\n- All implementations exist but aren't publicly exported\n\n### Exports to Add\n\n```typescript\n// Builder\nexport { createOpencodeRoute } from \"./builder\"\nexport type { RouteBuilder, RouteConfig } from \"./builder\"\n\n// Router\nexport { createRouter } from \"./router\"\nexport type { Router } from \"./router\"\n\n// Routes\nexport { createRoutes, routes } from \"./routes\"\n\n// Adapters\nexport { createNextHandler, createAction } from \"./adapters/next\"\nexport { createCaller } from \"./adapters/direct\"\nexport type { Caller, CallerContext } from \"./adapters/direct\"\n\n// Errors\nexport {\n  RouteError,\n  ValidationError,\n  TimeoutError,\n  HandlerError,\n  StreamError,\n  HeartbeatTimeoutError,\n  MiddlewareError,\n  RouteNotFoundError,\n} from \"./errors\"\n\n// Types\nexport type {\n  Route,\n  HandlerContext,\n  MiddlewareContext,\n} from \"./types\"\n```\n\n### Implementation Notes\n- Follow barrel export pattern\n- Export types separately with `export type` for tree-shaking\n- Error types are critical for typed error handling in consumers\n\n### Acceptance Criteria\n- [ ] All public APIs exported\n- [ ] Types exported for consumers\n- [ ] Error types exported for catchTag patterns\n- [ ] No circular dependencies","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T16:30:59.207Z","updated_at":"2025-12-29T16:31:31.981Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn0pmpd","title":"Create routes-config.ts with router instance","description":"## Create routes-config.ts with router instance\n\n**File:** `apps/web/src/core/router/routes-config.ts` (NEW)\n\n### Purpose\nCentral router instance that can be imported by adapters and consumers.\n\n### Implementation\n\n```typescript\n// apps/web/src/core/router/routes-config.ts\nimport { createRouter } from \"./router\"\nimport { createRoutes } from \"./routes\"\n\n/**\n * Singleton router instance for the application.\n * Import this in adapters and server components.\n */\nexport const router = createRouter(createRoutes())\n\n/**\n * Re-export route paths for type-safe caller usage.\n * Usage: caller<typeof routePaths>(\"session.get\", { id })\n */\nexport type RoutePaths = keyof ReturnType<typeof createRoutes>\n```\n\n### Why Separate File?\n- Avoids circular dependencies (routes.ts imports builder, router imports routes)\n- Single source of truth for router instance\n- Can add feature flag logic here later (subtask 11)\n\n### Consumers\n- `apps/web/src/app/api/router/route.ts` - Next.js API handler\n- `apps/web/src/core/router/actions.ts` - Server Actions\n- `apps/web/src/react/provider.tsx` - OpenCodeProvider\n- `apps/web/src/app/page.tsx` - Dashboard RSC\n- `apps/web/src/app/session/[id]/page.tsx` - Session RSC\n\n### Acceptance Criteria\n- [ ] Router instance created and exported\n- [ ] RoutePaths type exported for type-safe usage\n- [ ] No circular dependencies\n- [ ] Importable from all consumer locations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T16:30:59.209Z","updated_at":"2025-12-29T16:31:40.732Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn0yavq","title":"Create Server Actions wrapper (actions.ts)","description":"## Create Server Actions wrapper (actions.ts)\n\n**File:** `apps/web/src/core/router/actions.ts` (NEW)\n\n### Purpose\nServer Actions for client components that can't use createCaller directly.\n\n### Implementation\n\n```typescript\n// apps/web/src/core/router/actions.ts\n\"use server\"\n\nimport { createAction } from \"./adapters/next\"\nimport { router } from \"./routes-config\"\nimport { createClient } from \"@/core/client\"\n\n/**\n * Server Action caller for client components.\n * Automatically creates SDK client with directory from headers.\n */\nexport async function callRoute<TOutput>(\n  path: string,\n  input: unknown,\n  directory?: string\n): Promise<TOutput> {\n  const action = createAction(router.resolve(path), {\n    createContext: async () => ({\n      sdk: createClient(directory),\n    }),\n  })\n  \n  return action(input) as Promise<TOutput>\n}\n\n// Type-safe action creators for common routes\nexport const getSession = async (id: string, directory?: string) =>\n  callRoute(\"session.get\", { id }, directory)\n\nexport const createSession = async (title?: string, directory?: string) =>\n  callRoute(\"session.create\", { title }, directory)\n\nexport const listProviders = async (directory?: string) =>\n  callRoute(\"provider.list\", {}, directory)\n```\n\n### Usage in Client Components\n\n```typescript\n// In a client component\n\"use client\"\nimport { getSession, createSession } from \"@/core/router/actions\"\n\nconst session = await getSession(\"ses_123\", directory)\nconst newSession = await createSession(\"My Session\", directory)\n```\n\n### Implementation Notes\n- `\"use server\"` directive required at top\n- Directory passed explicitly (can't access headers in action)\n- Type-safe wrappers for common operations\n- Generic `callRoute` for flexibility\n\n### Acceptance Criteria\n- [ ] Server Actions file created with \"use server\" directive\n- [ ] Generic callRoute function works\n- [ ] Type-safe wrappers for common routes\n- [ ] Directory parameter supported\n- [ ] Works from client components","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:30:59.218Z","updated_at":"2025-12-29T16:31:50.763Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn1900w","title":"Migrate Dashboard page.tsx to use createCaller","description":"## Migrate Dashboard page.tsx to use createCaller\n\n**File:** `apps/web/src/app/page.tsx`\n\n### Current State\n- Line 82-142: `getProjectsWithSessions()` - cached server function\n- Line 88: `globalClient.project.list()` - global client (no directory)\n- Line 98: `createClient(project.worktree)` - per-project client\n- Line 99-103: `Promise.race` for 5s timeout on session.list\n\n### Changes Required\n\n**1. Import router and createCaller (top of file):**\n```typescript\nimport { createCaller } from \"@/core/router\"\nimport { router } from \"@/core/router/routes-config\"\nimport { createClient } from \"@/core/client\"\n```\n\n**2. Replace global client (line 88):**\n```typescript\n// BEFORE\nconst globalClient = createClient()\nconst projectsResult = await globalClient.project.list()\n\n// AFTER\nconst globalCaller = createCaller(router, { sdk: createClient() })\nconst projectsResult = await globalCaller(\"project.list\")\n```\n\n**3. Replace per-project client with timeout (line 98-103):**\n```typescript\n// BEFORE\nconst client = createClient(project.worktree)\nconst sessionsResponse = await Promise.race([\n  client.session.list(),\n  new Promise<{ data: Session[] }>((_, reject) =>\n    setTimeout(() => reject(new Error(\"timeout\")), 5000)\n  )\n])\n\n// AFTER\nconst projectCaller = createCaller(router, { \n  sdk: createClient(project.worktree) \n})\n// Timeout is now handled by route config (session.list has timeout: \"10s\")\nconst sessionsResponse = await projectCaller(\"session.list\")\n```\n\n### Implementation Notes\n- `\"use cache\"` directive (line 83) stays the same\n- Promise.all for parallel fetching (line 95-136) stays the same\n- Error handling for individual projects stays the same\n- Route timeout replaces Promise.race pattern\n\n### Why MEDIUM Complexity\n- Two different callers (global vs per-directory)\n- Promise.race removal requires route timeout config\n- Parallel fetching pattern must be preserved\n\n### Tests\n- Verify dashboard loads with caller\n- Verify timeout behavior (route-level)\n- Verify parallel project fetching works\n\n### Acceptance Criteria\n- [ ] Import createCaller and router\n- [ ] Global caller for project.list\n- [ ] Per-directory caller for session.list\n- [ ] Promise.race removed (route timeout instead)\n- [ ] Parallel fetching preserved\n- [ ] \"use cache\" preserved","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:30:59.229Z","updated_at":"2025-12-29T16:32:48.424Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn1bcga","title":"Migrate session/[id]/page.tsx to use createCaller","description":"## Migrate session/[id]/page.tsx to use createCaller\n\n**File:** `apps/web/src/app/session/[id]/page.tsx`\n\n### Current State\n- Line 28-38: `getSession()` - cached with `\"use cache\"`\n- Line 32-33: `createClient(directory)` + `client.session.get()`\n- Line 54-116: `getMessages()` - NOT cached (real-time)\n- Line 56-57: `createClient(directory)` + `client.session.messages()`\n- Line 71-96: SDK envelope unwrapping\n\n### Changes Required\n\n**1. Import router and createCaller (top of file):**\n```typescript\nimport { createCaller } from \"@/core/router\"\nimport { router } from \"@/core/router/routes-config\"\n```\n\n**2. Update getSession (line 28-38):**\n```typescript\n// BEFORE\nasync function getSession(id: string, directory?: string): Promise<Session | null> {\n  \"use cache\"\n  try {\n    const client = createClient(directory)\n    const result = await client.session.get({ path: { id } })\n    return result.data || null\n  } catch {\n    return null\n  }\n}\n\n// AFTER\nasync function getSession(id: string, directory?: string): Promise<Session | null> {\n  \"use cache\"\n  try {\n    const caller = createCaller(router, { sdk: createClient(directory) })\n    const result = await caller(\"session.get\", { id })\n    return result.data || null\n  } catch {\n    return null\n  }\n}\n```\n\n**3. Update getMessages (line 54-116):**\n```typescript\n// BEFORE (line 56-57)\nconst client = createClient(directory)\nconst result = await client.session.messages({ \n  path: { id }, \n  query: { limit: 50 } \n})\n\n// AFTER\nconst caller = createCaller(router, { sdk: createClient(directory) })\nconst result = await caller(\"session.messages\", { id, limit: 50 })\n```\n\n### Implementation Notes\n- `\"use cache\"` on getSession (line 29) stays the same\n- getMessages is NOT cached (line 49 comment) - stays the same\n- Data transformation (line 71-96) stays the same\n- UI message conversion (line 99-105) stays the same\n- Promise.all for parallel fetch (line 134-137) stays the same\n\n### Why MEDIUM Complexity\n- Two functions to update\n- Caching strategy must be preserved\n- Data transformation is complex but unchanged\n\n### Tests\n- Verify session page loads with caller\n- Verify caching works for getSession\n- Verify messages load correctly\n\n### Acceptance Criteria\n- [ ] Import createCaller and router\n- [ ] getSession uses caller with \"use cache\"\n- [ ] getMessages uses caller (no cache)\n- [ ] Data transformation unchanged\n- [ ] Parallel fetching preserved","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:30:59.231Z","updated_at":"2025-12-29T16:33:00.010Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn1017z","title":"Integrate caller into OpenCodeProvider","description":"## Integrate caller into OpenCodeProvider\n\n**File:** `apps/web/src/react/provider.tsx`\n\n### Current State\n- Line 32-42: `OpenCodeContextValue` interface - no caller\n- Line 83: `clientRef` holds SDK client\n- Line 99-182: `bootstrap()` uses direct SDK calls\n- Line 193-241: `sync()` uses direct SDK calls\n\n### VERIFIED: createCaller returns Promise, not Effect\nNo Effect imports needed. Use standard try/catch.\n\n### Changes Required\n\n**1. Update context interface (line 32-42):**\n```typescript\nimport { Caller } from \"@/core/router\"\n\ninterface OpenCodeContextValue {\n  url: string\n  directory: string\n  ready: boolean\n  sync: (sessionID: string) => Promise<void>\n  caller: Caller  // ADD THIS\n}\n```\n\n**2. Replace clientRef with callerRef (line 83):**\n```typescript\n// BEFORE\nconst clientRef = useRef(createClient(directory))\n\n// AFTER\nimport { createCaller } from \"@/core/router\"\nimport { router } from \"@/core/router/routes-config\"\n\nconst callerRef = useRef(\n  createCaller(router, { sdk: createClient(directory) })\n)\n```\n\n**3. Update bootstrap() (line 99-182):**\n```typescript\n// BEFORE (line 104)\nconst sessionsResult = await client.session.list()\nif (sessionsResult.data) { ... }\n\n// AFTER (caller returns unwrapped data, throws on error)\nconst sessions = await callerRef.current(\"session.list\")\n// sessions is already Session[], no .data unwrapping\n\n// BEFORE (line 132)\nconst statusResult = await client.session.status({ path: { id: sessionID } })\n\n// AFTER\nconst status = await callerRef.current(\"session.status\", { id: sessionID })\n\n// BEFORE (line 151)\nconst providersResult = await client.provider.list()\n\n// AFTER\nconst providers = await callerRef.current(\"provider.list\")\n```\n\n**4. Update sync() (line 193-241):**\n```typescript\n// BEFORE (line 200-205)\nconst [messagesResult, todoResult, diffResult] = await Promise.allSettled([\n  client.session.messages({ path: { id: sessionID }, query: { limit: 100 } }),\n  client.session.todo({ path: { id: sessionID } }),\n  client.session.diff({ path: { id: sessionID } })\n])\n\n// AFTER (caller returns unwrapped data)\nconst [messagesResult, todoResult, diffResult] = await Promise.allSettled([\n  callerRef.current(\"session.messages\", { id: sessionID, limit: 100 }),\n  callerRef.current(\"session.todo\", { id: sessionID }),\n  callerRef.current(\"session.diff\", { id: sessionID })\n])\n// Results are unwrapped - access directly, not via .data\n```\n\n**5. Expose caller in context (line 328-333):**\n```typescript\nconst value: OpenCodeContextValue = {\n  url,\n  directory,\n  ready,\n  sync,\n  caller: callerRef.current,  // ADD THIS\n}\n```\n\n### Implementation Notes\n- Keep SDK client creation inside caller (for directory scoping)\n- Caller is stable reference (useRef) - safe for useEffect deps\n- Error handling stays the same (Promise.allSettled pattern)\n- SSE subscription unchanged (uses different mechanism - OUT OF SCOPE)\n- **No Effect imports needed** - caller returns Promise\n- **No .data unwrapping** - routes return unwrapped data\n\n### Tests\n- Update provider.test.ts to mock caller instead of client\n- Verify bootstrap works with caller\n- Verify sync works with caller\n\n### Acceptance Criteria\n- [ ] Context interface updated with caller\n- [ ] clientRef replaced with callerRef\n- [ ] bootstrap() uses caller for all SDK calls\n- [ ] sync() uses caller for all SDK calls\n- [ ] Remove .data unwrapping (routes return unwrapped)\n- [ ] caller exposed in context value\n- [ ] Tests updated and passing","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T16:30:59.220Z","updated_at":"2025-12-29T16:38:28.920Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn12ueg","title":"Migrate use-send-message.ts to use caller","description":"## Migrate use-send-message.ts to use caller\n\n**File:** `apps/web/src/react/use-send-message.ts`\n\n### Current State\n- Line 94: Creates fresh SDK client per message\n- Line 101: `client.session.promptAsync()` - fire-and-forget\n- Line 115-121: SDK error response handling\n- Line 151-157: Catch block with error state\n\n### VERIFIED: createCaller returns Promise, not Effect\nNo Effect imports needed. Use standard try/catch.\n\n### Changes Required\n\n**1. Get caller from context (add near line 84):**\n```typescript\nconst { caller } = useOpenCode()\n```\n\n**2. Replace SDK call in processMessage (line 94-121):**\n```typescript\n// BEFORE\nconst client = createClient(directory, sessionId)\nconst response = await client.session.promptAsync({\n  path: { id: sessionId },\n  body: { parts: apiParts, model }\n})\n\nif (response.error) {\n  const errorMessage = typeof response.error === \"object\" && \"message\" in response.error\n    ? String(response.error.message)\n    : String(response.error)\n  throw new Error(errorMessage)\n}\n\n// AFTER (simple - caller returns Promise, throws on error)\nawait caller(\"session.promptAsync\", {\n  id: sessionId,\n  parts: apiParts,\n  model\n})\n// No response handling needed - promptAsync returns void (204)\n// Errors are thrown as exceptions, caught by existing catch block\n```\n\n### Implementation Notes\n- Queue logic (line 35-46) stays the same\n- Session status monitoring (line 84) stays the same\n- Auto-process on idle (line 194-199) stays the same\n- Existing catch block (line 151-157) handles errors - no changes needed\n- **No Effect imports needed** - caller returns Promise\n\n### Tests\n- Update use-send-message.test.ts\n- Mock caller instead of SDK client\n- Verify queue processing still works\n- Verify error handling works\n\n### Acceptance Criteria\n- [ ] Get caller from useOpenCode context\n- [ ] Replace client.session.promptAsync with caller\n- [ ] Use existing try/catch for error handling (no Effect)\n- [ ] Queue logic unchanged\n- [ ] Session status monitoring unchanged\n- [ ] Tests updated and passing","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:30:59.222Z","updated_at":"2025-12-29T16:37:54.559Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn14on7","title":"Migrate use-providers.ts to use caller","description":"## Migrate use-providers.ts to use caller\n\n**File:** `apps/web/src/react/use-providers.ts`\n\n### Current State\n- Line 54: `createClient(directory)` - memoized\n- Line 65: `client.provider.list()` - fetches on mount\n- Line 84-88: Catch block with error state\n- Line 71-81: Dictionary to array transformation\n\n### VERIFIED: createCaller returns Promise, not Effect\nNo Effect imports needed. Use standard try/catch.\n\n### Changes Required\n\n**1. Get caller from context (replace line 54):**\n```typescript\n// BEFORE\nconst client = useMemo(() => createClient(directory), [directory])\n\n// AFTER\nconst { caller } = useOpenCode()\n```\n\n**2. Replace SDK call (line 65):**\n```typescript\n// BEFORE\nconst response = await client.provider.list()\nif (response.data) {\n  const rawProviders = response.data.all ?? []\n  // transform...\n}\n\n// AFTER (caller returns unwrapped data, throws on error)\nconst response = await caller(\"provider.list\")\n// response is already unwrapped - no .data access needed\nconst rawProviders = response.all ?? []\n// transform...\n```\n\n**3. Error handling stays the same (line 84-88):**\n```typescript\n// Existing catch block works - caller throws on error\n} catch (err) {\n  const error = err instanceof Error ? err : new Error(String(err))\n  setError(error)\n}\n```\n\n### Implementation Notes\n- Data transformation (line 71-81) stays the same\n- Loading state management stays the same\n- **No Effect imports needed** - caller returns Promise\n- **No .data unwrapping** - routes return unwrapped data\n\n### Tests\n- Update use-providers.test.ts\n- Mock caller instead of SDK client\n- Verify provider list transforms correctly\n\n### Acceptance Criteria\n- [ ] Get caller from useOpenCode context\n- [ ] Replace client.provider.list with caller\n- [ ] Remove .data unwrapping (routes return unwrapped)\n- [ ] Use existing try/catch for errors (no Effect)\n- [ ] Data transformation unchanged\n- [ ] Tests updated and passing","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:30:59.224Z","updated_at":"2025-12-29T16:38:03.583Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn165oy","title":"Migrate use-create-session.ts to use caller","description":"## Migrate use-create-session.ts to use caller\n\n**File:** `apps/web/src/react/use-create-session.ts`\n\n### Current State\n- Line 93: `createClient(directory)` - fresh per call\n- Line 94: `client.session.create({ body: { title } })`\n- Line 102-106: SDK error response handling\n- Line 109-112: Catch block with error state\n\n### VERIFIED: createCaller returns Promise, not Effect\nNo Effect imports needed. Use standard try/catch.\n\n### Changes Required\n\n**1. Get caller from context (add near line 87):**\n```typescript\nconst { caller } = useOpenCode()\n```\n\n**2. Replace SDK call in createSession callback (line 93-106):**\n```typescript\n// BEFORE\nconst client = createClient(directory)\nconst result = await client.session.create({ body: { title } })\n\nif (result.error) {\n  throw new Error(\n    typeof result.error === \"object\" && \"message\" in result.error\n      ? String(result.error.message)\n      : \"Failed to create session\"\n  )\n}\n\n// AFTER (simple - caller returns unwrapped data, throws on error)\nconst result = await caller(\"session.create\", { title })\n// result is already unwrapped Session object\n// Errors thrown as exceptions, caught by existing catch block\n```\n\n### Implementation Notes\n- Loading state (line 84-85) stays the same\n- Navigation after create (line 107) stays the same\n- Store update (line 100) stays the same\n- Existing catch block handles errors - no changes needed\n- **No Effect imports needed** - caller returns Promise\n- **No .data unwrapping** - routes return unwrapped data\n\n### Tests\n- Update use-create-session.test.ts (if exists)\n- Mock caller instead of SDK client\n- Verify session creation works\n\n### Acceptance Criteria\n- [ ] Get caller from useOpenCode context\n- [ ] Replace client.session.create with caller\n- [ ] Remove .data unwrapping and error checking (routes handle this)\n- [ ] Use existing try/catch for errors (no Effect)\n- [ ] Navigation after create unchanged\n- [ ] Tests updated and passing","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:30:59.226Z","updated_at":"2025-12-29T16:38:11.742Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrec1wynon","title":"TDD: Add all SDK routes (session, provider, prompt)","description":"Add all SDK operation routes to routes.ts with full TDD.\n\n## TDD Order\n1. Write failing tests in routes.test.ts for ALL routes\n2. Implement routes in routes.ts\n3. Verify tests pass\n\n## Routes to Add\n\n### Session Routes\n- session.get: { id: string } → Session (timeout: 30s)\n- session.list: {} → Session[] (timeout: 10s)\n- session.create: { title?: string } → Session (timeout: 30s)\n- session.delete: { id: string } → void (timeout: 10s)\n- session.promptAsync: { sessionId: string, parts: Part[], model?: ModelSelection } → void (timeout: 5m, retry: exponential)\n\n### Provider Routes\n- provider.list: {} → { all: Provider[], default: Provider, connected: string[] } (timeout: 10s)\n\n## Implementation Notes\n- Follow existing messages.list pattern\n- Unwrap .data in handler\n- Use Schema.Struct for input validation\n- createCaller returns Promise, not Effect\n- promptAsync is fire-and-forget (returns 204)\n\n## Files\n- apps/web/src/core/router/routes.ts\n- apps/web/src/core/router/routes.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T16:52:18.226Z","updated_at":"2025-12-29T16:59:35.349Z","closed_at":"2025-12-29T16:59:35.349Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrec3yxraw","title":"TDD: Add public exports to index.ts","description":"Export all public API from index.ts with TDD.\n\n## TDD Order\n1. Write failing test in index.test.ts that imports from index.ts\n2. Add exports to index.ts\n3. Verify test passes\n\n## Exports to Add\n- createRouter from router.ts\n- createOpencodeRoute from builder.ts\n- createCaller from adapters/direct.ts\n- createNextHandler, createAction from adapters/next.ts\n- createRoutes, Routes type from routes.ts\n- All error types from errors.ts\n- Schedule types from schedule.ts\n\n## Implementation Notes\n- Re-export pattern: export { X } from './module'\n- Include type exports: export type { X } from './module'\n\n## Files\n- apps/web/src/core/router/index.ts\n- apps/web/src/core/router/index.test.ts\n\n## Dependencies\n- Depends on: TDD: Add all SDK routes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T16:52:20.889Z","updated_at":"2025-12-29T17:02:46.896Z","closed_at":"2025-12-29T17:02:46.896Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrec5pi8xr","title":"TDD: Integrate caller into provider context","description":"Add caller to OpenCodeProvider context so hooks can access it.\n\n## TDD Order\n1. Update provider.tsx tests to verify caller in context\n2. Modify provider.tsx to create and expose caller\n3. Update useOpenCode hook to return caller\n4. Verify tests pass\n\n## Implementation\n- Create caller in provider using createCaller(router, { sdk })\n- Add caller to context value\n- Export useOpenCode hook that returns { caller, ... }\n\n## Implementation Notes\n- Caller needs SDK instance (from createClient)\n- Caller is directory-scoped (use directory from context)\n- This enables all migrated hooks to access caller\n\n## Files\n- apps/web/src/react/provider.tsx\n- apps/web/src/react/use-provider.ts\n\n## Dependencies\n- Depends on: TDD: Add public exports to index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T16:52:23.142Z","updated_at":"2025-12-29T17:12:20.401Z","closed_at":"2025-12-29T17:12:20.401Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrec7dtxh3","title":"TDD: Migrate use-providers hook to caller","description":"Migrate use-providers.ts to use router caller instead of direct SDK.\n\n## TDD Order\n1. Update use-providers.test.ts to test caller-based implementation\n2. Modify use-providers.ts to use caller\n3. Verify tests pass\n\n## Migration Pattern\n- Replace: const response = await client.provider.list()\n- With: const response = await caller('provider.list')\n- Remove: createClient import\n- Add: useOpenCode hook for caller access\n\n## Implementation Notes\n- Caller returns unwrapped data (no .data access)\n- Error handling via try/catch (caller throws)\n- Keep same public interface (providers, isLoading, error)\n\n## Files\n- apps/web/src/react/use-providers.ts\n- apps/web/src/react/use-providers.test.ts\n\n## Dependencies\n- Depends on: TDD: Integrate caller into provider context","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:52:25.313Z","updated_at":"2025-12-29T17:22:26.689Z","closed_at":"2025-12-29T17:22:26.689Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrec97gtc2","title":"TDD: Migrate use-create-session hook to caller","description":"Migrate use-create-session.ts to use router caller instead of direct SDK.\n\n## TDD Order\n1. Write/update tests to test caller-based implementation\n2. Modify use-create-session.ts to use caller\n3. Verify tests pass\n\n## Migration Pattern\n- Replace: const result = await client.session.create({ body: { title } })\n- With: const result = await caller('session.create', { title })\n- Remove: createClient import\n- Add: useOpenCode hook for caller access\n\n## Implementation Notes\n- Caller returns unwrapped Session (no .data access)\n- Error handling via try/catch (caller throws)\n- Keep same public interface (createSession, isCreating, error)\n\n## Files\n- apps/web/src/react/use-create-session.ts\n\n## Dependencies\n- Depends on: TDD: Integrate caller into provider context","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:52:27.676Z","updated_at":"2025-12-29T17:22:27.444Z","closed_at":"2025-12-29T17:22:27.444Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrecb4d92v","title":"TDD: Migrate use-send-message hook to caller","description":"Migrate use-send-message.ts to use router caller instead of direct SDK.\n\n## TDD Order\n1. Update use-send-message.test.ts to test caller-based implementation\n2. Modify use-send-message.ts to use caller\n3. Verify tests pass\n\n## Migration Pattern\n- Replace: await client.session.promptAsync({ path: { id }, body: { parts, model } })\n- With: await caller('session.promptAsync', { sessionId, parts, model })\n- Remove: createClient import\n- Add: useOpenCode hook for caller access\n\n## Implementation Notes\n- Keep FIFO queue logic intact\n- Keep session status integration\n- Caller returns void (204 response)\n- Error handling via try/catch\n\n## Files\n- apps/web/src/react/use-send-message.ts\n- apps/web/src/react/use-send-message.test.ts\n\n## Dependencies\n- Depends on: TDD: Integrate caller into provider context","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:52:30.157Z","updated_at":"2025-12-29T17:22:28.459Z","closed_at":"2025-12-29T17:22:28.459Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn0cu1h","title":"Effect Router Migration: Wire Up Routes and Migrate Consumers","description":"Migrate from manual async patterns to the Effect-based router per docs/guides/ROUTER_MIGRATION.md.\n\n## ✅ COMPLETED (Dec 29, 2024)\n\n### Phase 1: Routes (Worker 1)\n- Added 6 routes: session.get, session.list, session.create, session.delete, session.promptAsync, provider.list\n- 25 tests passing\n- Fixed pre-existing type errors in errors.ts and executor.ts\n\n### Phase 2: Public Exports (Worker 2)\n- Added all public exports to index.ts\n- 16 tests passing\n\n### Phase 3: Provider Integration (Worker 3)\n- Integrated caller into OpenCodeProvider context\n- useOpenCode() now returns { caller, ... }\n- 3 tests passing\n\n### Phase 4: Hook Migrations (Workers 4-6, parallel)\n- use-providers.ts → caller('provider.list') - 4 tests\n- use-create-session.ts → caller('session.create', {...}) - 6 tests\n- use-send-message.ts → caller('session.promptAsync', {...}) - 14 tests\n\n### Total: 68 new tests, all passing\n\n## 🔜 REMAINING (Later Phases)\n- Feature flag for gradual rollout (opencode-next--xts0a-mjrdkn1dgq0)\n- Delete old Promise.race patterns (opencode-next--xts0a-mjrdkn1fs1f)\n\n## Success Criteria (ACHIEVED)\n✅ All SDK operations have typed routes with timeout/retry config\n✅ Hooks use caller instead of direct SDK\n✅ Provider exposes caller in context\n✅ All tests pass","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T16:30:59.196Z","updated_at":"2025-12-29T18:19:03.694Z","closed_at":"2025-12-29T18:19:03.694Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn1dgq0","title":"Add feature flag for gradual rollout","description":"## Add feature flag for gradual rollout\n\n**File:** `apps/web/src/core/router/routes-config.ts`\n\n### Purpose\nEnable gradual rollout by switching between Effect router and legacy SDK calls.\n\n### Implementation\n\n```typescript\n// apps/web/src/core/router/routes-config.ts\nimport { createRouter } from \"./router\"\nimport { createRoutes } from \"./routes\"\nimport { createClient } from \"@/core/client\"\n\n/**\n * Feature flag for Effect router migration.\n * Set NEXT_PUBLIC_USE_EFFECT_ROUTER=true to enable.\n */\nexport const useEffectRouter = \n  process.env.NEXT_PUBLIC_USE_EFFECT_ROUTER === \"true\"\n\n/**\n * Router instance (only created if feature flag enabled).\n */\nexport const router = useEffectRouter \n  ? createRouter(createRoutes()) \n  : null\n\n/**\n * Factory for creating caller with fallback to legacy SDK.\n * \n * Usage:\n * const caller = createCallerWithFallback(directory)\n * const result = await caller(\"session.get\", { id })\n */\nexport function createCallerWithFallback(directory?: string) {\n  if (useEffectRouter && router) {\n    return createCaller(router, { sdk: createClient(directory) })\n  }\n  \n  // Legacy fallback - returns SDK-compatible caller\n  const client = createClient(directory)\n  return async (path: string, input?: unknown) => {\n    const [namespace, method] = path.split(\".\")\n    const sdk = client[namespace as keyof typeof client]\n    const fn = sdk[method as keyof typeof sdk] as Function\n    return fn(input)\n  }\n}\n```\n\n### Environment Variable\nAdd to `.env.local`:\n```\nNEXT_PUBLIC_USE_EFFECT_ROUTER=false\n```\n\n### Rollout Strategy\n1. Deploy with flag=false (no behavior change)\n2. Enable in staging: flag=true\n3. Monitor error rates for 24 hours\n4. Enable in production\n5. Remove flag and legacy code (subtask 12)\n\n### Implementation Notes\n- `NEXT_PUBLIC_` prefix required for client-side access\n- Fallback creates SDK-compatible caller interface\n- Router only instantiated if flag enabled (tree-shaking)\n\n### Acceptance Criteria\n- [ ] Feature flag environment variable defined\n- [ ] Router conditionally created\n- [ ] createCallerWithFallback provides unified interface\n- [ ] Legacy fallback works identically to SDK\n- [ ] Flag documented in README or .env.example","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T16:30:59.233Z","updated_at":"2025-12-29T18:20:15.452Z","closed_at":"2025-12-29T18:20:15.452Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrdkn1fs1f","title":"Delete old Promise.race timeout patterns","description":"## Delete old Promise.race timeout patterns\n\n**Files:** \n- `apps/web/src/app/page.tsx`\n- `apps/web/src/react/provider.tsx`\n\n### Purpose\nClean up legacy timeout patterns after Effect router migration is complete.\n\n### Patterns to Remove\n\n**1. page.tsx (line 99-103):**\n```typescript\n// DELETE THIS\nconst sessionsResponse = await Promise.race([\n  client.session.list(),\n  new Promise<{ data: Session[] }>((_, reject) =>\n    setTimeout(() => reject(new Error(\"timeout\")), 5000)\n  )\n])\n\n// ALREADY REPLACED WITH\nconst sessionsResponse = await projectCaller(\"session.list\")\n// Route has timeout: \"10s\" built-in\n```\n\n**2. provider.tsx - Check for any Promise.race patterns:**\n- Search for `Promise.race` in file\n- Remove if found (should be replaced by route timeouts)\n\n### Other Cleanup\n\n**Remove unused imports:**\n- `setTimeout` if only used for timeouts\n- Any timeout-related utilities\n\n**Remove legacy client creation:**\n- If `createClient` is only used for caller creation, consolidate\n- Keep `createClient` export for SDK client (caller needs it)\n\n### Prerequisites\n- Subtask 9 (Dashboard migration) must be complete\n- Subtask 5 (Provider integration) must be complete\n- Feature flag enabled and tested in production\n\n### Implementation Notes\n- Only delete after confirming Effect router works\n- Keep feature flag logic until fully rolled out\n- This is cleanup, not migration\n\n### Acceptance Criteria\n- [ ] All Promise.race timeout patterns removed\n- [ ] Unused timeout-related code deleted\n- [ ] No regression in timeout behavior (route-level works)\n- [ ] Tests still pass\n- [ ] Feature flag can be removed after this","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T16:30:59.235Z","updated_at":"2025-12-29T18:24:36.455Z","closed_at":"2025-12-29T18:24:36.455Z","parent_id":"opencode-next--xts0a-mjrdkn0cu1h","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hmf4ig","title":"Fix noUncheckedIndexedAccess type errors after tsconfig update","description":"Updated tsconfig.json to Matt Pocock's recommended settings including noUncheckedIndexedAccess. Need to fix all resulting type errors across 22 files.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T18:08:04.215Z","updated_at":"2025-12-29T18:17:20.277Z","closed_at":"2025-12-29T18:17:20.277Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hmmjc4","title":"Fix store.ts and store.test.ts type errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.222Z","updated_at":"2025-12-29T18:17:04.491Z","closed_at":"2025-12-29T18:17:04.491Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hmqpf8","title":"Fix tool.tsx and error-boundary.tsx type errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.226Z","updated_at":"2025-12-29T18:17:06.013Z","closed_at":"2025-12-29T18:17:06.013Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hmtzas","title":"Fix session-layout.test.tsx and session-messages.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.229Z","updated_at":"2025-12-29T18:17:06.706Z","closed_at":"2025-12-29T18:17:06.706Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hn2pke","title":"Fix PromptInput.tsx and PromptInput.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.238Z","updated_at":"2025-12-29T18:17:07.853Z","closed_at":"2025-12-29T18:17:07.853Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hn6vu5","title":"Fix router executor.ts and schedule.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.242Z","updated_at":"2025-12-29T18:17:08.976Z","closed_at":"2025-12-29T18:17:08.976Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hn9256","title":"Fix lib files (binary, prompt-api, prompt-parsing)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.245Z","updated_at":"2025-12-29T18:17:09.911Z","closed_at":"2025-12-29T18:17:09.911Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrh1hncdfo","title":"Fix react hooks test files","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:08:04.248Z","updated_at":"2025-12-29T18:17:10.586Z","closed_at":"2025-12-29T18:17:10.586Z","parent_id":"opencode-next--xts0a-mjrh1hmf4ig","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrhzvd7hfg","title":"Subagent Display: Full Implementation","description":"Implement expandable subagent display with child session tracking, SSE subscription, and real-time UI updates. Takes coverage from 15% to 100% per SUBAGENT_DISPLAY.md guide.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T18:34:48.331Z","updated_at":"2025-12-29T18:34:48.331Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrhzvds9xj","title":"SubagentView + PartRenderer Components","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T18:34:48.352Z","updated_at":"2025-12-29T18:34:48.352Z","parent_id":"opencode-next--xts0a-mjrhzvd7hfg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrhzvdtxuv","title":"Task.tsx Integration + Polish","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T18:34:48.353Z","updated_at":"2025-12-29T18:34:48.353Z","parent_id":"opencode-next--xts0a-mjrhzvd7hfg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrhzvde0s7","title":"Subagent Store + Types","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:34:48.338Z","updated_at":"2025-12-29T18:41:01.001Z","closed_at":"2025-12-29T18:41:01.001Z","parent_id":"opencode-next--xts0a-mjrhzvd7hfg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrhzvdhgeh","title":"useSubagent Selector Hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:34:48.341Z","updated_at":"2025-12-29T18:53:26.687Z","closed_at":"2025-12-29T18:53:26.687Z","parent_id":"opencode-next--xts0a-mjrhzvd7hfg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrhzvdj08y","title":"useSubagentSync SSE Hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:34:48.343Z","updated_at":"2025-12-29T18:53:27.130Z","closed_at":"2025-12-29T18:53:27.130Z","parent_id":"opencode-next--xts0a-mjrhzvd7hfg","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofxd6d2","title":"ADR-002: OpenCode Vibe as Agent Swarm Control Plane","description":"Vision document for opencode-vibe as the control plane and orchestration layer for running agent swarms over OpenCode. Covers incremental path from current state to k8s-scale multi-user agentic swarms. Deep research into agent patterns, memory architectures, and production deployment from pdf-brain.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T18:53:54.721Z","updated_at":"2025-12-29T18:53:54.721Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofy1dty","title":"Write Phases 1-2: Multi-Server Discovery + Async Workers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T18:53:54.745Z","updated_at":"2025-12-29T18:53:54.745Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofy4r94","title":"Write Phases 3-5: Multi-User + Cloud + K8s Vision","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T18:53:54.748Z","updated_at":"2025-12-29T18:53:54.748Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofy69at","title":"Create Architecture Diagrams (ASCII art)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T18:53:54.750Z","updated_at":"2025-12-29T18:53:54.750Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofxjvhy","title":"Research: Agent Coordination & Multi-Agent Patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:53:54.727Z","updated_at":"2025-12-29T18:56:48.811Z","closed_at":"2025-12-29T18:56:48.811Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofxnf5l","title":"Research: Agent Memory Architectures (Mem0, A-MEM, Zep)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:53:54.731Z","updated_at":"2025-12-29T18:56:49.558Z","closed_at":"2025-12-29T18:56:49.558Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofxxnpg","title":"Research: Production Deployment & Scaling Patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T18:53:54.741Z","updated_at":"2025-12-29T18:56:50.172Z","closed_at":"2025-12-29T18:56:50.172Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjriofxz4zn","title":"Draft ADR-002 Structure and Current State (Phase 0)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:53:54.743Z","updated_at":"2025-12-29T19:03:36.518Z","closed_at":"2025-12-29T19:03:36.518Z","parent_id":"opencode-next--xts0a-mjriofxd6d2","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrj7ayl72o","title":"Consolidate SSE to MultiServerSSE + No Server Empty State","description":"Remove SSEProvider entirely. MultiServerSSE becomes the single SSE system.\n\n## Goals\n1. Delete SSEProvider and useSSE hook\n2. Migrate all SSE consumers to MultiServerSSE\n3. Add adaptive polling (2s when no servers, 30s when connected)\n4. Add \"No Server\" empty state UI when no OpenCode servers discovered\n5. Silent reconnect attempts, show message after ~10s\n\n## Architecture After\n- MultiServerSSE discovers all servers via /api/opencode-servers\n- OpenCodeProvider subscribes to MultiServerSSE events\n- No hardcoded OPENCODE_FALLBACK_URL dependency\n- Clean single-system SSE architecture","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T19:08:34.749Z","updated_at":"2025-12-29T19:15:33.779Z","closed_at":"2025-12-29T19:15:33.779Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrj7ayvxay","title":"Add adaptive polling to MultiServerSSE (fast 2s → slow 30s)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:08:34.759Z","updated_at":"2025-12-29T19:15:27.292Z","closed_at":"2025-12-29T19:15:27.292Z","parent_id":"opencode-next--xts0a-mjrj7ayl72o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrj7ayyvff","title":"Migrate OpenCodeProvider from SSEProvider to MultiServerSSE","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:08:34.762Z","updated_at":"2025-12-29T19:15:28.079Z","closed_at":"2025-12-29T19:15:28.079Z","parent_id":"opencode-next--xts0a-mjrj7ayl72o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrj7az7wpt","title":"Migrate remaining useSSE consumers to MultiServerSSE","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:08:34.771Z","updated_at":"2025-12-29T19:15:29.219Z","closed_at":"2025-12-29T19:15:29.219Z","parent_id":"opencode-next--xts0a-mjrj7ayl72o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrj7az989z","title":"Delete SSEProvider and useSSE (dead code removal)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:08:34.773Z","updated_at":"2025-12-29T19:15:30.500Z","closed_at":"2025-12-29T19:15:30.500Z","parent_id":"opencode-next--xts0a-mjrj7ayl72o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrj7azco4w","title":"Add NoServerState component with start instructions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:08:34.776Z","updated_at":"2025-12-29T19:15:31.846Z","closed_at":"2025-12-29T19:15:31.846Z","parent_id":"opencode-next--xts0a-mjrj7ayl72o","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i8e8kb","title":"Effect-Atom Server Discovery Migration","description":"Incrementally migrate to dynamic server discovery using effect-atom and router infrastructure. Stay operational at every step. Output: working discovery + ADR-004 for full migration path.\n\nKEY CONSTRAINT: Never remove working defaults. localhost:4056 must always be fallback.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T19:36:43.790Z","updated_at":"2025-12-29T20:05:04.598Z","closed_at":"2025-12-29T20:05:04.598Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i8ope5","title":"Create ServerDiscovery Effect service","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:36:43.800Z","updated_at":"2025-12-29T19:42:30.047Z","closed_at":"2025-12-29T19:42:30.047Z","parent_id":"opencode-next--xts0a-mjrk7i8e8kb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i8xr9t","title":"Create getServerForDirectory helper","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:36:43.809Z","updated_at":"2025-12-29T19:42:30.770Z","closed_at":"2025-12-29T19:42:30.770Z","parent_id":"opencode-next--xts0a-mjrk7i8e8kb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i9010t","title":"Install effect-atom and create atoms/servers.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:36:43.812Z","updated_at":"2025-12-29T19:52:12.751Z","closed_at":"2025-12-29T19:52:12.751Z","parent_id":"opencode-next--xts0a-mjrk7i8e8kb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i92bar","title":"Update client.ts to use atoms with fallback","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:36:43.814Z","updated_at":"2025-12-29T20:00:07.309Z","closed_at":"2025-12-29T20:00:07.309Z","parent_id":"opencode-next--xts0a-mjrk7i8e8kb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i94kiz","title":"Update page.tsx to use async client","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:36:43.816Z","updated_at":"2025-12-29T20:02:20.419Z","closed_at":"2025-12-29T20:02:20.419Z","parent_id":"opencode-next--xts0a-mjrk7i8e8kb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrk7i95u0h","title":"Write ADR-004: Effect-Atom Migration","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T19:36:43.817Z","updated_at":"2025-12-29T20:04:53.867Z","closed_at":"2025-12-29T20:04:53.867Z","parent_id":"opencode-next--xts0a-mjrk7i8e8kb","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrkp64rzez","title":"Project list not picking up new sessions (cache invalidation)","description":"The project list page uses \"use cache\" directive but doesn't have proper cache invalidation. New sessions don't appear until cache expires or page is hard-refreshed.\n\nOptions:\n1. Add cacheLife with short TTL\n2. Add cacheTag and revalidate on SSE session.created events\n3. Remove cache entirely (simplest but less performant)\n\nFound during Effect-Atom Server Discovery Migration epic.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T19:50:27.915Z","updated_at":"2025-12-29T19:51:45.263Z","closed_at":"2025-12-29T19:51:45.263Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi5et2u","title":"Effect-Atom Migration (ADR 004)","description":"Incremental migration from Zustand to effect-atom. Phase 1 atoms exist but need wiring. Phases 2-4 need implementation. Each phase preserves working defaults and coexists with Zustand.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-29T20:10:56.546Z","updated_at":"2025-12-29T20:32:26.097Z","closed_at":"2025-12-29T20:32:26.097Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi5ksy7","title":"Phase 1: Wire server discovery atoms to components","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:10:56.552Z","updated_at":"2025-12-29T20:21:25.774Z","closed_at":"2025-12-29T20:21:25.774Z","parent_id":"opencode-next--xts0a-mjrlfi5et2u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi5okhs","title":"Phase 2a: Create SSE atom with Effect.Stream","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:10:56.556Z","updated_at":"2025-12-29T20:21:27.219Z","closed_at":"2025-12-29T20:21:27.219Z","parent_id":"opencode-next--xts0a-mjrlfi5et2u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi5rhbr","title":"Phase 2b: Integrate SSE atom with existing use-sse hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:10:56.559Z","updated_at":"2025-12-29T20:26:48.266Z","closed_at":"2025-12-29T20:26:48.266Z","parent_id":"opencode-next--xts0a-mjrlfi5et2u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi5ze3r","title":"Phase 3a: Create sessions atom with cache invalidation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:10:56.567Z","updated_at":"2025-12-29T20:26:49.484Z","closed_at":"2025-12-29T20:26:49.484Z","parent_id":"opencode-next--xts0a-mjrlfi5et2u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi62099","title":"Phase 3b: Integrate sessions atom with use-session hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:10:56.570Z","updated_at":"2025-12-29T20:32:22.679Z","closed_at":"2025-12-29T20:32:22.679Z","parent_id":"opencode-next--xts0a-mjrlfi5et2u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrlfi64ot0","title":"Phase 4: Create messages atom with binary search insertion","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:10:56.572Z","updated_at":"2025-12-29T20:32:24.000Z","closed_at":"2025-12-29T20:32:24.000Z","parent_id":"opencode-next--xts0a-mjrlfi5et2u","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0wvqlh","title":"Phase 5: Full Zustand Replacement","description":"Complete migration from Zustand to effect-atom pattern. Remove all Zustand dependencies and feature flags. ADR 004 final phase.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T20:34:40.543Z","updated_at":"2025-12-29T20:34:40.543Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xo9v3","title":"Update atoms/index.ts with all new exports","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:34:40.572Z","updated_at":"2025-12-29T20:34:40.572Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xq7b6","title":"Migrate use-compaction-state to atoms","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:34:40.574Z","updated_at":"2025-12-29T20:34:40.574Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xsylv","title":"Migrate use-context-usage to atoms","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:34:40.576Z","updated_at":"2025-12-29T20:34:40.576Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xujni","title":"Migrate use-messages-with-parts to atoms","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:34:40.578Z","updated_at":"2025-12-29T20:34:40.578Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xyvzk","title":"Remove feature flags and make atoms default","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:34:40.582Z","updated_at":"2025-12-29T20:34:40.582Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0y0k9m","title":"Remove Zustand from store.ts and delete file","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T20:34:40.584Z","updated_at":"2025-12-29T20:34:40.584Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0y4d8c","title":"Remove Zustand dependency from package.json","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T20:34:40.588Z","updated_at":"2025-12-29T20:34:40.588Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0x2u80","title":"Create parts atom for message parts state","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:34:40.550Z","updated_at":"2025-12-29T20:41:38.758Z","closed_at":"2025-12-29T20:41:38.758Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0x62s7","title":"Create providers atom for provider state","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:34:40.554Z","updated_at":"2025-12-29T20:41:39.400Z","closed_at":"2025-12-29T20:41:39.400Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0x83uk","title":"Create projects atom for project state","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:34:40.556Z","updated_at":"2025-12-29T20:41:40.043Z","closed_at":"2025-12-29T20:41:40.043Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xh1wx","title":"Migrate subagent-store to atoms","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:34:40.565Z","updated_at":"2025-12-29T20:41:41.072Z","closed_at":"2025-12-29T20:41:41.072Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrma0xkiib","title":"Migrate prompt-store to atoms","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:34:40.568Z","updated_at":"2025-12-29T20:41:41.894Z","closed_at":"2025-12-29T20:41:41.894Z","parent_id":"opencode-next--xts0a-mjrma0wvqlh","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrn4xx251c","title":"ADR: Swarmtools Package Extraction","description":"Comprehensive ADR for extracting @joelhooks/swarmtools-router (Effect core) and @joelhooks/swarmtools-react (hooks) packages. ESM unbundled distribution. Ultrathink depth - detailed enough that extraction is mechanical.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T20:58:42.998Z","updated_at":"2025-12-29T20:58:42.998Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrn4xxbk54","title":"Research: Inventory core router/client implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:58:43.007Z","updated_at":"2025-12-29T21:05:29.484Z","closed_at":"2025-12-29T21:05:29.484Z","parent_id":"opencode-next--xts0a-mjrn4xx251c","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrn4xxe8qt","title":"Research: Inventory React hooks and atoms","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:58:43.010Z","updated_at":"2025-12-29T21:05:31.457Z","closed_at":"2025-12-29T21:05:31.457Z","parent_id":"opencode-next--xts0a-mjrn4xx251c","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrn4xxmwgh","title":"Design: @joelhooks/swarmtools-router API surface","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:58:43.018Z","updated_at":"2025-12-29T21:17:02.828Z","closed_at":"2025-12-29T21:17:02.828Z","parent_id":"opencode-next--xts0a-mjrn4xx251c","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrn4xxpf95","title":"Design: @joelhooks/swarmtools-react API surface","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:58:43.021Z","updated_at":"2025-12-29T21:17:03.576Z","closed_at":"2025-12-29T21:17:03.576Z","parent_id":"opencode-next--xts0a-mjrn4xx251c","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrn4xxs4fe","title":"Synthesize: Final ADR with migration path","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:58:43.024Z","updated_at":"2025-12-29T21:21:06.046Z","closed_at":"2025-12-29T21:21:06.046Z","parent_id":"opencode-next--xts0a-mjrn4xx251c","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogtdjmfe","title":"Extract @opencode-vibe packages (router + react)","description":"ADR 005 implementation: Extract @opencode-vibe/router (Effect core) and @opencode-vibe/react (React bindings) from apps/web. TDD, ESM unbundled, publish to npm.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T21:35:56.599Z","updated_at":"2025-12-29T21:35:56.599Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogte9mou","title":"Final verification + turbo build + publish prep","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T21:35:56.625Z","updated_at":"2025-12-29T21:35:56.625Z","parent_id":"opencode-next--xts0a-mjrogtdjmfe","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogtdpb5j","title":"Create packages/router scaffold + copy files","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T21:35:56.605Z","updated_at":"2025-12-29T21:41:31.084Z","closed_at":"2025-12-29T21:41:31.084Z","parent_id":"opencode-next--xts0a-mjrogtdjmfe","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogtdumgl","title":"Fix router package imports + verify tests pass","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T21:35:56.610Z","updated_at":"2025-12-30T00:23:32.606Z","closed_at":"2025-12-30T00:23:32.606Z","parent_id":"opencode-next--xts0a-mjrogtdjmfe","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogtdwkc0","title":"Create packages/react scaffold + copy files","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T21:35:56.612Z","updated_at":"2025-12-29T21:41:32.053Z","closed_at":"2025-12-29T21:41:32.053Z","parent_id":"opencode-next--xts0a-mjrogtdjmfe","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogte6rid","title":"Fix react package imports + verify tests pass","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-29T21:35:56.622Z","updated_at":"2025-12-30T00:23:34.054Z","closed_at":"2025-12-30T00:23:34.054Z","parent_id":"opencode-next--xts0a-mjrogtdjmfe","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrogte7dsr","title":"Update apps/web to use extracted packages","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T21:35:56.623Z","updated_at":"2025-12-30T00:33:13.609Z","closed_at":"2025-12-30T00:33:13.609Z","parent_id":"opencode-next--xts0a-mjrogtdjmfe","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjruzbah5cz","title":"ADR: Extract core/ to @opencode-vibe/core package","description":"apps/web/src/core/ is doing heavy lifting that prevents thin app wrappers:\n\n**Current core/ contents:**\n- client.ts - SDK factory with directory scoping\n- discovery.ts - Browser-based server discovery  \n- server-discovery.ts - Node.js lsof-based discovery\n- server-routing.ts - Pure routing logic\n- multi-server-sse.ts - SSE connection manager\n\n**Goal:** Any React/Vue/Svelte/vanilla app should be able to:\n```ts\nimport { createClient, discoverServers } from '@opencode-vibe/core'\nimport { useSession, useSendMessage } from '@opencode-vibe/react'\n```\n\n**Proposed @opencode-vibe/core:**\n- SDK client factory (framework-agnostic)\n- Server discovery (browser + Node.js)\n- SSE primitives (not React-specific)\n- Multi-server routing\n\n**apps/web becomes thin wrapper:**\n- Next.js routes\n- UI components\n- App-specific atoms/stores\n\nThis enables OpenCode integration in ANY JS framework.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-30T00:38:17.321Z","updated_at":"2025-12-30T00:38:17.321Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y15age","title":"ADR 006: Extract @opencode-vibe/core - Thin Client Architecture","description":"## ADR 006: Extract @opencode-vibe/core - Thin Client Architecture\n\n### BLOCKER: React in Core (mjrz40qfmnc)\nThe \"atoms\" are React hooks, not Effect programs. Must refactor to pure Effect.\n\n### CONTINUATION INSTRUCTIONS\nQuery: `semantic-memory_find(query=\"adr-006 React blocker Effect refactor\", collection=\"swarm-coordination\")`\n\n### Progress: 6/10 done, but atoms need refactor\n- ✅ Task 0: Rename router → core\n- ✅ Task 1: Move utils\n- ✅ Task 2: Move discovery\n- ✅ Task 3: Move client\n- ✅ Task 4: Move SSE\n- ⚠️ Task 5: Move atoms - NEEDS REFACTOR (React hooks → Effect programs)\n- ⏳ Task 6: Update react - BLOCKED on refactor\n- ✅ Task 7: Update apps/web, delete dead code\n- ✅ Task 8: Create core index.ts\n- ⏳ Task 9: ADR + verification - BLOCKED\n\n### Current Blocker Work\nCell: mjrz40qfmnc - Refactor atoms to pure Effect programs\n- Remove React deps from core\n- Make @opencode-ai/sdk a peerDependency\n- Avoid barrel files\n\n### MANDATE: React = MINIMAL. Core = pure Effect.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-30T01:38:39.305Z","updated_at":"2025-12-30T03:24:47.945Z","closed_at":"2025-12-30T03:24:47.945Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y1dugm","title":"Rename packages/router to packages/core and update package.json","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T01:38:39.313Z","updated_at":"2025-12-30T01:46:18.645Z","closed_at":"2025-12-30T01:46:18.645Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y1hcjx","title":"Move utils (binary, prompt-api, prompt-parsing) to core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.317Z","updated_at":"2025-12-30T01:56:43.261Z","closed_at":"2025-12-30T01:56:43.261Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y1jzym","title":"Move discovery modules to core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.319Z","updated_at":"2025-12-30T01:56:45.097Z","closed_at":"2025-12-30T01:56:45.097Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y1ma4k","title":"Move client module to core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.322Z","updated_at":"2025-12-30T02:10:23.567Z","closed_at":"2025-12-30T02:10:23.567Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y1vuvi","title":"Move SSE module to core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.331Z","updated_at":"2025-12-30T02:14:19.461Z","closed_at":"2025-12-30T02:14:19.461Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y1x86m","title":"Move atoms to core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.333Z","updated_at":"2025-12-30T02:27:23.192Z","closed_at":"2025-12-30T02:27:23.192Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y22cib","title":"Update packages/react to import from core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.338Z","updated_at":"2025-12-30T03:24:32.297Z","closed_at":"2025-12-30T03:24:32.297Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y246a8","title":"Update apps/web imports and delete dead code","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.340Z","updated_at":"2025-12-30T03:24:33.873Z","closed_at":"2025-12-30T03:24:33.873Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y27jvl","title":"Create core package index.ts with public API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.343Z","updated_at":"2025-12-30T03:24:35.081Z","closed_at":"2025-12-30T03:24:35.081Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrx4y2a5ig","title":"Update ADR 006 and run final verification","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:38:39.346Z","updated_at":"2025-12-30T03:24:36.498Z","closed_at":"2025-12-30T03:24:36.498Z","parent_id":"opencode-next--xts0a-mjrx4y15age","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjrz40qfmnc","title":"BLOCKER: Remove React dependency from @opencode-vibe/core","description":"## Problem\nCore package has React as a dependency. This breaks the architecture mandate.\n\nThe \"atoms\" in packages/core/src/atoms/ are actually React hooks (useState, useEffect, \"use client\"). They should NOT be in core.\n\n## Current State\n```\npackages/core/src/atoms/\n├── sessions.ts    # Uses useState, useEffect - THIS IS A REACT HOOK\n├── messages.ts    # Uses useState, useEffect - THIS IS A REACT HOOK\n├── parts.ts       # Uses useState, useEffect - THIS IS A REACT HOOK\n... (all 9 files are React hooks)\n```\n\n## Required Fix\nTwo options:\n\n### Option A: Move \"atoms\" back to react package\n- These are React hooks, they belong in react\n- Core stays pure (Effect, SDK, no React)\n- React package has hooks that wrap SDK calls\n\n### Option B: Refactor atoms to be pure Effect programs\n- Convert useState/useEffect to Effect.gen\n- Core exports Effect programs\n- React package has hooks that run Effect programs\n\nOption A is faster. Option B is cleaner long-term.\n\n## Dependencies\n- @opencode-ai/sdk should be peerDependency, not dependency\n- eventsource-parser is fine as dependency\n- React must be REMOVED from core\n\n## Continuation\nQuery: semantic-memory_find(query=\"adr-006 core-extraction\", collection=\"swarm-coordination\")","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T02:33:55.383Z","updated_at":"2025-12-30T03:24:30.637Z","closed_at":"2025-12-30T03:24:30.637Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1jn8lzo8","title":"ADR 006 React Consolidation - Delete Duplicate Implementations","description":"BLOCKER for ADR 006 completion. After extraction, we have TWO React implementations creating different contexts. Runtime error: \"useOpenCode must be used within OpenCodeProvider\".\n\nSolution: Delete apps/web/src/react/ duplicates, keep only re-export barrel from @opencode-vibe/react.\n\nSequential execution required - each step depends on previous.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T03:42:03.621Z","updated_at":"2025-12-30T03:42:03.621Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1jn97tsb","title":"Update apps/web/src/react/index.ts to re-export from @opencode-vibe/react","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T03:42:03.643Z","updated_at":"2025-12-30T03:42:03.643Z","parent_id":"opencode-next--xts0a-mjs1jn8lzo8","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1jn9a8dx","title":"Fix broken imports in apps/web after deletion","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T03:42:03.646Z","updated_at":"2025-12-30T03:42:03.646Z","parent_id":"opencode-next--xts0a-mjs1jn8lzo8","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1jn9d180","title":"Verify build and runtime - no context errors","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T03:42:03.649Z","updated_at":"2025-12-30T03:42:03.649Z","parent_id":"opencode-next--xts0a-mjs1jn8lzo8","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1dtvixtl","title":"Dual API for @opencode-vibe/core: Promise + Effect","description":"Add Promise API as default export, Effect API via /effect subpath. Makes core accessible to non-Effect users while preserving power-user Effect API.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-30T03:37:32.286Z","updated_at":"2025-12-30T04:02:47.320Z","closed_at":"2025-12-30T04:02:47.320Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1dtvrsy2","title":"Create Promise API wrappers in packages/core/src/api/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T03:37:32.295Z","updated_at":"2025-12-30T03:49:09.367Z","closed_at":"2025-12-30T03:49:09.367Z","parent_id":"opencode-next--xts0a-mjs1dtvixtl","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1dtvv0qw","title":"Add /effect subpath export for Effect atoms","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T03:37:32.299Z","updated_at":"2025-12-30T03:49:10.053Z","closed_at":"2025-12-30T03:49:10.053Z","parent_id":"opencode-next--xts0a-mjs1dtvixtl","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1dtw7s8z","title":"Update default export to expose Promise API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:37:32.311Z","updated_at":"2025-12-30T03:51:57.414Z","closed_at":"2025-12-30T03:51:57.414Z","parent_id":"opencode-next--xts0a-mjs1dtvixtl","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1dtwb5l2","title":"Update React hooks to use Promise API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:37:32.315Z","updated_at":"2025-12-30T04:00:42.603Z","closed_at":"2025-12-30T04:00:42.603Z","parent_id":"opencode-next--xts0a-mjs1dtvixtl","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1jn8s6pq","title":"Verify packages/react has full implementations (not stubs)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T03:42:03.628Z","updated_at":"2025-12-30T03:45:23.205Z","closed_at":"2025-12-30T03:45:23.205Z","parent_id":"opencode-next--xts0a-mjs1jn8lzo8","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs1jn8xa7y","title":"Delete duplicate files from apps/web/src/react/","description":"CRITICAL: COPY FIRST, then delete.\n\nVerification found 2 STUBS in packages/react that need real implementations:\n\n1. COPY apps/web/src/react/provider.tsx → packages/react/src/providers/opencode-provider.tsx\n   - Real: 380 lines with SSE sync, store init, context creation\n   - Stub: 47 lines with empty sync()\n\n2. COPY apps/web/src/react/use-sse.tsx → packages/react/src/providers/sse-provider.tsx\n   - Real: 518 lines with full SSE implementation\n   - Stub: 20 lines placeholder\n\n3. After copying, DELETE all other duplicates from apps/web/src/react/:\n   - provider.tsx (now copied)\n   - use-sse.tsx (now copied)\n   - store.ts\n   - use-*.ts (all hooks)\n   - *.test.ts (all tests)\n\n4. Keep ONLY:\n   - index.ts (will be updated in next subtask)\n   - README.md (optional)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T03:42:03.633Z","updated_at":"2025-12-30T03:45:36.786Z","parent_id":"opencode-next--xts0a-mjs1jn8lzo8","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-next--xts0a-mjs29f89bbw","title":"Fix type errors in apps/web after dual API migration","description":"After dual API migration, apps/web has type errors due to missing exports from @/react alias. Need to fix imports and ensure all hooks/types are properly exported from packages/react.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-30T04:02:06.297Z","updated_at":"2025-12-30T04:02:45.873Z","closed_at":"2025-12-30T04:02:45.873Z","parent_id":"opencode-next--xts0a-mjs1dtvixtl","dependencies":[],"labels":[],"comments":[]}
